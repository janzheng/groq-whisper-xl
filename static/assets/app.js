var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(e){let t;return l(e,e=>t=e)(),t}function a(e,t,n){e.$$.on_destroy.push(l(t,n))}function c(e,t,n){return e.set(n),t}function d(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function m(e){e.parentNode&&e.parentNode.removeChild(e)}function p(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function g(e){return document.createTextNode(e)}function b(){return g(" ")}function h(){return g("")}function x(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function _(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t,n){const r=t.toLowerCase();r in e?e[r]="boolean"==typeof e[r]&&""===n||n:t in e?e[t]="boolean"==typeof e[t]&&""===n||n:_(e,t,n)}function y(e,t){t=""+t,e.data!==t&&(e.data=t)}function k(e,t){e.value=null==t?"":t}function w(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function S(e,t,n){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}n&&void 0===t||(e.selectedIndex=-1)}function $(e){const t=e.querySelector(":checked");return t&&t.__value}function j(e,t,n){e.classList.toggle(t,!!n)}let C;function T(e){C=e}function L(){if(!C)throw new Error("Function called outside component initialization");return C}function E(e){L().$$.on_mount.push(e)}function M(e){L().$$.on_destroy.push(e)}function z(){const e=L();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}(t,n,{cancelable:r});return o.slice().forEach(t=>{t.call(e,i)}),!i.defaultPrevented}return!0}}const A=[],F=[];let O=[];const D=[],I=Promise.resolve();let R=!1;function P(e){O.push(e)}const U=new Set;let N=0;function B(){if(0!==N)return;const e=C;do{try{for(;N<A.length;){const e=A[N];N++,T(e),J(e.$$)}}catch(e){throw A.length=0,N=0,e}for(T(null),A.length=0,N=0;F.length;)F.pop()();for(let e=0;e<O.length;e+=1){const t=O[e];U.has(t)||(U.add(t),t())}O.length=0}while(A.length);for(;D.length;)D.pop()();R=!1,U.clear(),T(e)}function J(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(P)}}const W=new Set;let H;function G(){H={r:0,c:[],p:H}}function q(){H.r||r(H.c),H=H.p}function V(e,t){e&&e.i&&(W.delete(e),e.i(t))}function K(e,t,n,r){if(e&&e.o){if(W.has(e))return;W.add(e),H.c.push(()=>{W.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function X(e){return void 0!==e?.length?e:Array.from(e)}function Q(e,t){K(e,1,1,()=>{t.delete(e.key)})}function Y(e){e&&e.c()}function Z(e,n,i){const{fragment:l,after_update:s}=e.$$;l&&l.m(n,i),P(()=>{const n=e.$$.on_mount.map(t).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]}),s.forEach(P)}function ee(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];O.forEach(r=>-1===e.indexOf(r)?t.push(r):n.push(r)),n.forEach(e=>e()),O=t}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function te(e,t){-1===e.$$.dirty[0]&&(A.push(e),R||(R=!0,I.then(B)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ne(t,o,i,l,s,a,c=null,d=[-1]){const u=C;T(t);const p=t.$$={fragment:null,ctx:[],props:a,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(u?u.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||u.$$.root};c&&c(p.root);let f=!1;if(p.ctx=i?i(t,o.props||{},(e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&s(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),f&&te(t,e)),n}):[],p.update(),f=!0,r(p.before_update),p.fragment=!!l&&l(p.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);p.fragment&&p.fragment.l(e),e.forEach(m)}else p.fragment&&p.fragment.c();o.intro&&V(t.$$.fragment),Z(t,o.target,o.anchor),B()}T(u)}class re{$$=void 0;$$set=void 0;$destroy(){ee(this,1),this.$destroy=e}$on(t,n){if(!o(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function oe(t){let n;return{c(){n=f("div"),n.innerHTML='<div class="flex items-center gap-2 text-lg font-bold"><iconify-icon icon="mdi:lightning-bolt" class="text-terminal-accent"></iconify-icon> <span class="text-terminal-accent">Groq Whisper XL</span></div> <div class="text-terminal-text-dim mt-2">Fast, accurate audio transcription powered by Groq&#39;s Whisper API with intelligent chunking and LLM enhancement.</div> <div class="mt-3"><div class="space-y-1 text-sm"><div class="flex items-center gap-2 text-terminal-text-dim"><iconify-icon icon="mdi:file-music" class="text-xs"></iconify-icon> <span>Universal file support up to 1GB with smart processing</span></div> <div class="flex items-center gap-2 text-terminal-text-dim"><iconify-icon icon="mdi:brain" class="text-xs"></iconify-icon> <span>AI-powered error correction for improved accuracy</span></div> <div class="flex items-center gap-2 text-terminal-text-dim"><iconify-icon icon="mdi:play-speed" class="text-xs"></iconify-icon> <span>Real-time streaming transcription with live results</span></div></div></div>',_(n,"class","border-2 border-terminal-border bg-terminal-bg-light p-4 mb-4")},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&m(n)}}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class ie extends re{constructor(e){super(),ne(this,e,null,oe,i,{})}}const le=[];function se(t,n=e){let r;const o=new Set;function l(e){if(i(t,e)&&(t=e,r)){const e=!le.length;for(const e of o)e[1](),le.push(e,t);if(e){for(let e=0;e<le.length;e+=2)le[e][0](le[e+1]);le.length=0}}}function s(e){l(e(t))}return{set:l,update:s,subscribe:function(i,a=e){const c=[i,a];return o.add(c),1===o.size&&(r=n(l,s)||e),i(t),()=>{o.delete(c),0===o.size&&r&&(r(),r=null)}}}}class ae{static levels={DEBUG:0,INFO:1,WARN:2,ERROR:3};static emojis={start:"🚀",processing:"🔄",complete:"✅",failed:"❌",upload:"📤",download:"📥",file:"📁",delete:"🗑️",audio:"🎵",transcribe:"🎤",chunk:"🧩",stream:"🌊",llm:"🧠",api:"📡",webhook:"🔗",url:"🌐",info:"ℹ️",warning:"⚠️",error:"❌",debug:"🔍",stats:"📊",time:"⏱️",progress:"📈"};constructor(e="WEB",t=ae.levels.INFO){this.context=e,this.level=t}_formatMessage(e,t,n=null){(new Date).toLocaleTimeString();const r=`${e} [${this.context}]`;return n&&Object.keys(n).length,`${r} ${t}`}debug(e,t=null){if(this.level<=ae.levels.DEBUG){const n=this._formatMessage(ae.emojis.debug,e,t);console.log(n,t)}}info(e,t,n=null){if(this.level<=ae.levels.INFO){const r=ae.emojis[e]||e,o=this._formatMessage(r,t,n);console.log(o,n)}}warn(e,t=null){if(this.level<=ae.levels.WARN){const n=this._formatMessage(ae.emojis.warning,e,t);console.warn(n,t)}}error(e,t=null,n=null){if(this.level<=ae.levels.ERROR){const r=this._formatMessage(ae.emojis.error,e,n);console.error(r,t,n)}}upload(e,t=null){this.info("upload",e,t)}download(e,t=null){this.info("download",e,t)}processing(e,t=null){this.info("processing",e,t)}complete(e,t=null){this.info("complete",e,t)}chunk(e,t=null){this.info("chunk",e,t)}transcribe(e,t=null){this.info("transcribe",e,t)}llm(e,t=null){this.info("llm",e,t)}api(e,t=null){this.info("api",e,t)}stats(e,t=null){this.info("stats",e,t)}stream(e,t=null){this.info("stream",e,t)}}const ce=new ae("WEB",ae.levels.INFO),de=new ae("STREAM",ae.levels.INFO),ue=se([]),me=se(!1),pe=se(!1),fe=se(!1),ge=se(""),be=se(Date.now()),he=se(0),xe=se(""),_e=se(0),ve=se(0),ye=se(""),ke=se("disabled"),we=se(!1),Se=se(!1),$e=se(!1),je=se([]),Ce=se("speed"),Te=se({upload:0,processing:0,overall:0}),Le=se(""),Ee=se(""),Me=se(0),ze=se(0),Ae=se(0),Fe=se(0),Oe=se(0),De=se(""),Ie="";function Re(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}let Pe=0;function Ue(e,t){je.update(n=>{if(n[e]){const r={...n[e],...t};"complete"===t.status&&"complete"!==n[e].status&&(r.completedAt=(new Date).toISOString(),r.arrivalOrder=Pe++),n[e]=r}return[...n]})}function Ne(e){const t=Date.now()-new Date(e.created_at).getTime();return"streaming"===e.processing_method&&("processing"===e.status||"uploading"===e.status)||("chunked_upload_streaming"===e.processing_method&&("processing"===e.status||"uploading"===e.status)||"streaming"===e.processing_method&&t<3e5)}async function Be(){try{console.log("=== FETCH JOBS CALLED ===");const e=s(ue);console.log("Jobs before fetch:",e.length,e.map(e=>({id:e.job_id.slice(0,8)+"...",method:e.processing_method})));const t=await fetch("/jobs");if(t.ok){const n=(await t.json()).jobs||[];console.log("Server returned jobs:",n.length,n.map(e=>({id:e.job_id.slice(0,8)+"...",method:e.processing_method||"direct"})));const r=new Set(e.map(e=>e.job_id)),o=n.filter(e=>!r.has(e.job_id));console.log("New server jobs to add:",o.length,o.map(e=>({id:e.job_id.slice(0,8)+"...",method:e.processing_method||"direct"})));const i=[];for(const t of e){const e=n.find(e=>e.job_id===t.job_id);if(e)i.push({...t,...e,..."streaming"===t.processing_method?{raw_transcript:t.raw_transcript||e.raw_transcript,corrected_transcript:t.corrected_transcript||e.corrected_transcript,final_transcript:t.final_transcript||e.final_transcript,transcripts:t.transcripts||e.transcripts||[]}:{}});else{Ne(t)?i.push(t):console.log("Removing local job that no longer exists on server:",t.job_id.slice(0,8)+"...",t.processing_method)}}const l=[...i,...o],s=[],a=new Set;for(const e of l)a.has(e.job_id)||(a.add(e.job_id),s.push(e));ue.set(s),console.log("Jobs after fetch and deduplication:",s.length,s.map(e=>({id:e.job_id.slice(0,8)+"...",method:e.processing_method}))),ce.info("api","Fetched jobs",{server_jobs:n.length,new_server_jobs:o.length,local_jobs_preserved:e.length,total:s.length,duplicates_removed:l.length-s.length})}}catch(e){console.error("Fetch jobs error:",e),ce.error("Failed to fetch jobs",e)}}function Je(e,t,n){const r=e.slice();return r[35]=t[n],r}function We(e){let t,n,r;return{c(){t=f("input"),_(t,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),_(t,"type","url"),_(t,"placeholder","https://example.com/audio.mp3")},m(o,i){u(o,t,i),k(t,e[1]),n||(r=x(t,"input",e[24]),n=!0)},p(e,n){2&n[0]&&t.value!==e[1]&&k(t,e[1])},d(e){e&&m(t),n=!1,r()}}}function He(e){let t,n,o,i,l,s,a,c,p,h,k,w,S,$,C=e[8].title+"",T=e[8].subtitle+"",L=e[8].description&&Ge(e);return{c(){t=f("div"),n=f("iconify-icon"),i=b(),l=f("div"),s=g(C),a=b(),c=f("div"),p=g(T),h=b(),L&&L.c(),k=b(),w=f("input"),v(n,"icon",o=e[8].icon),v(n,"class","text-3xl mb-2"),j(n,"text-terminal-text-dim",!e[8].success&&!e[8].error),j(n,"text-terminal-accent","mdi:file-music"===e[8].icon),j(n,"animate-spin","mdi:loading"===e[8].icon),_(l,"class","font-bold"),_(c,"class","text-xs"),j(c,"text-terminal-text-dim",!e[8].success&&!e[8].error),j(c,"text-terminal-accent","mdi:file-music"===e[8].icon),_(t,"role","button"),_(t,"tabindex","0"),_(t,"class","border-2 border-dashed border-terminal-border p-6 text-center cursor-pointer transition-all hover:border-terminal-accent hover:bg-gray-900/20"),j(t,"text-status-success",e[8].success),j(t,"text-status-error",e[8].error),_(w,"type","file"),_(w,"accept","audio/*,video/*"),_(w,"class","hidden")},m(r,o){u(r,t,o),d(t,n),d(t,i),d(t,l),d(l,s),d(t,a),d(t,c),d(c,p),d(t,h),L&&L.m(t,null),e[21](t),u(r,k,o),u(r,w,o),e[23](w),S||($=[x(t,"click",e[16]),x(t,"keydown",e[22]),x(t,"dragover",e[12]),x(t,"dragleave",e[13]),x(t,"drop",e[14]),x(w,"change",e[15])],S=!0)},p(e,r){256&r[0]&&o!==(o=e[8].icon)&&v(n,"icon",o),256&r[0]&&j(n,"text-terminal-text-dim",!e[8].success&&!e[8].error),256&r[0]&&j(n,"text-terminal-accent","mdi:file-music"===e[8].icon),256&r[0]&&j(n,"animate-spin","mdi:loading"===e[8].icon),256&r[0]&&C!==(C=e[8].title+"")&&y(s,C),256&r[0]&&T!==(T=e[8].subtitle+"")&&y(p,T),256&r[0]&&j(c,"text-terminal-text-dim",!e[8].success&&!e[8].error),256&r[0]&&j(c,"text-terminal-accent","mdi:file-music"===e[8].icon),e[8].description?L?L.p(e,r):(L=Ge(e),L.c(),L.m(t,null)):L&&(L.d(1),L=null),256&r[0]&&j(t,"text-status-success",e[8].success),256&r[0]&&j(t,"text-status-error",e[8].error)},d(n){n&&(m(t),m(k),m(w)),L&&L.d(),e[21](null),e[23](null),S=!1,r($)}}}function Ge(e){let t,n,r=e[8].description+"";return{c(){t=f("div"),n=g(r),_(t,"class","text-xs text-terminal-text-dim")},m(e,r){u(e,t,r),d(t,n)},p(e,t){256&t[0]&&r!==(r=e[8].description+"")&&y(n,r)},d(e){e&&m(t)}}}function qe(t){let n,r,o=t[35].label+"";return{c(){n=f("option"),r=g(o),n.__value=t[35].value,k(n,n.__value)},m(e,t){u(e,n,t),d(n,r)},p:e,d(e){e&&m(n)}}}function Ve(e){let t;return{c(){t=f("div"),t.textContent="⚠️ Large files (>15MB) are automatically chunked. Chunks will be saved to R2 debug storage for inspection.\n              Check logs for full R2 URLs to access files directly.",_(t,"class","text-xs text-terminal-text-dim mt-1 ml-6")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Ke(e){let t;return{c(){t=g("Transcribe Audio")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Xe(e){let t;return{c(){t=g("Processing...")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Qe(t){let n,o,i,l,s,a,c,g,h,y,w,$,C,T,L,E,M,z,A,F,O,D,I,R,U,N,B,J,W,H,G,q,V,K,Q,Y,Z,ee,te,ne,re,oe,ie,le,se,ae,ce,de,ue,me,pe,fe,ge,be,he,xe,_e,ve,ye,ke,we,Se,$e,je,Ce,Te,Le,Ee,Me,ze,Ae;function Fe(e,t){return"file"===e[0]?He:We}let Oe=Fe(t),De=Oe(t),Ie=X(t[11]),Re=[];for(let e=0;e<Ie.length;e+=1)Re[e]=qe(Je(t,Ie,e));let Pe=t[9]&&Ve();function Ue(e,t){return e[10]?Xe:Ke}let Ne=Ue(t),Be=Ne(t);return{c(){n=f("div"),o=f("div"),o.innerHTML='<iconify-icon icon="mdi:microphone" class="text-lg"></iconify-icon> <span>Direct Transcription</span>',i=b(),l=f("div"),l.textContent="Upload files or URLs for complete transcription. Results available when processing is done.",s=b(),a=f("div"),c=f("div"),c.textContent="Source:",g=b(),h=f("div"),y=f("button"),y.innerHTML='<iconify-icon icon="mdi:file-outline"></iconify-icon> File',w=b(),$=f("button"),$.innerHTML='<iconify-icon icon="mdi:web"></iconify-icon> URL',C=b(),De.c(),T=b(),L=f("div"),E=f("div"),E.textContent="Settings:",M=b(),z=f("div"),A=f("div"),F=f("label"),F.textContent="Whisper model:",O=b(),D=f("select");for(let e=0;e<Re.length;e+=1)Re[e].c();I=b(),R=f("div"),R.innerHTML="💡 <strong>Turbo:</strong> Faster processing, <strong>v3:</strong> Higher accuracy",U=b(),N=f("div"),B=f("label"),B.textContent="Chunk size for large files:",J=b(),W=f("select"),H=f("option"),H.textContent="5MB (Smaller chunks)",G=f("option"),G.textContent="10MB (Default)",q=f("option"),q.textContent="20MB (Larger chunks)",V=f("option"),V.textContent="50MB (Fewer API calls)",K=f("option"),K.textContent="100MB (Maximum efficiency)",Q=b(),Y=f("div"),Y.textContent="💡 Files over 15MB are automatically chunked using this size. Larger chunks = fewer API calls.",Z=b(),ee=f("div"),te=f("label"),ne=f("input"),re=b(),oe=f("iconify-icon"),ie=b(),le=f("span"),le.textContent="LLM Error Correction",se=b(),ae=f("span"),ae.textContent="(Improves accuracy)",ce=b(),de=f("div"),ue=f("label"),ue.textContent="Webhook URL (optional):",me=b(),pe=f("input"),fe=b(),ge=f("div"),be=f("div"),be.textContent="🐛 Debug Options",he=b(),xe=f("div"),_e=f("label"),ve=f("input"),ye=b(),ke=f("iconify-icon"),we=b(),Se=f("span"),Se.textContent="Save chunks to debug storage",$e=b(),je=f("span"),je.textContent="(For troubleshooting large file chunks)",Ce=b(),Pe&&Pe.c(),Te=b(),Le=f("button"),Ee=f("iconify-icon"),Me=b(),Be.c(),_(o,"class","flex items-center gap-2 mb-4 font-bold text-terminal-accent"),_(l,"class","text-xs text-terminal-text-dim mb-4"),_(c,"class","font-bold mb-2"),_(y,"class","border border-terminal-border text-terminal-text px-4 py-2 hover:bg-yellow-400 transition-colors flex-1 flex items-center justify-center gap-2"),j(y,"bg-yellow-400","file"===t[0]),j(y,"bg-terminal-bg","file"!==t[0]),_($,"class","border border-terminal-border text-terminal-text px-4 py-2 hover:bg-yellow-400 transition-colors flex-1 flex items-center justify-center gap-2"),j($,"bg-yellow-400","url"===t[0]),j($,"bg-terminal-bg","url"!==t[0]),_(h,"class","flex gap-2 mb-3"),_(a,"class","mb-4"),_(E,"class","font-bold mb-2"),_(F,"for","model-select"),_(F,"class","text-terminal-text-dim block mb-1"),_(D,"id","model-select"),_(D,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===t[3]&&P(()=>t[25].call(D)),_(R,"class","text-xs text-terminal-text-dim mt-1"),_(B,"for","chunk-size-direct"),_(B,"class","text-terminal-text-dim block mb-1"),H.__value=5,k(H,H.__value),G.__value=10,k(G,G.__value),q.__value=20,k(q,q.__value),V.__value=50,k(V,V.__value),K.__value=100,k(K,K.__value),_(W,"id","chunk-size-direct"),_(W,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===t[4]&&P(()=>t[26].call(W)),_(Y,"class","text-xs text-terminal-text-dim mt-1"),_(ne,"type","checkbox"),_(ne,"class","w-4 h-4"),v(oe,"icon","mdi:brain"),v(oe,"class","text-terminal-accent"),_(le,"class","text-terminal-accent"),_(ae,"class","text-terminal-text-dim"),_(te,"class","flex items-center gap-2 cursor-pointer"),_(ue,"for","webhook-url"),_(ue,"class","text-terminal-text-dim block mb-1"),_(pe,"id","webhook-url"),_(pe,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),_(pe,"type","url"),_(pe,"placeholder","https://your-webhook.com/endpoint"),_(be,"class","text-terminal-text font-bold mb-2 text-sm"),_(ve,"type","checkbox"),_(ve,"class","w-4 h-4"),v(ke,"icon","mdi:folder-download"),v(ke,"class","text-terminal-text-dim"),_(Se,"class","text-terminal-text"),_(je,"class","text-terminal-text-dim text-xs"),_(_e,"class","flex items-center gap-2 cursor-pointer"),_(ge,"class","border border-terminal-border p-2"),_(z,"class","space-y-3"),_(L,"class","mb-4 flex-1"),v(Ee,"icon","mdi:microphone"),Le.disabled=t[10],_(Le,"class","bg-terminal-accent text-terminal-bg px-4 py-2 hover:bg-gray-700 transition-colors w-full font-bold flex items-center justify-center gap-2"),j(Le,"opacity-50",t[10]),_(n,"class","border border-terminal-border p-4 flex flex-col")},m(e,r){u(e,n,r),d(n,o),d(n,i),d(n,l),d(n,s),d(n,a),d(a,c),d(a,g),d(a,h),d(h,y),d(h,w),d(h,$),d(a,C),De.m(a,null),d(n,T),d(n,L),d(L,E),d(L,M),d(L,z),d(z,A),d(A,F),d(A,O),d(A,D);for(let e=0;e<Re.length;e+=1)Re[e]&&Re[e].m(D,null);S(D,t[3],!0),d(A,I),d(A,R),d(z,U),d(z,N),d(N,B),d(N,J),d(N,W),d(W,H),d(W,G),d(W,q),d(W,V),d(W,K),S(W,t[4],!0),d(N,Q),d(N,Y),d(z,Z),d(z,ee),d(ee,te),d(te,ne),ne.checked=t[2],d(te,re),d(te,oe),d(te,ie),d(te,le),d(te,se),d(te,ae),d(z,ce),d(z,de),d(de,ue),d(de,me),d(de,pe),k(pe,t[5]),d(z,fe),d(z,ge),d(ge,be),d(ge,he),d(ge,xe),d(xe,_e),d(_e,ve),ve.checked=t[9],d(_e,ye),d(_e,ke),d(_e,we),d(_e,Se),d(_e,$e),d(_e,je),d(xe,Ce),Pe&&Pe.m(xe,null),d(n,Te),d(n,Le),d(Le,Ee),d(Le,Me),Be.m(Le,null),ze||(Ae=[x(y,"click",t[19]),x($,"click",t[20]),x(D,"change",t[25]),x(W,"change",t[26]),x(ne,"change",t[27]),x(pe,"input",t[28]),x(ve,"change",t[29]),x(Le,"click",t[17])],ze=!0)},p(e,t){if(1&t[0]&&j(y,"bg-yellow-400","file"===e[0]),1&t[0]&&j(y,"bg-terminal-bg","file"!==e[0]),1&t[0]&&j($,"bg-yellow-400","url"===e[0]),1&t[0]&&j($,"bg-terminal-bg","url"!==e[0]),Oe===(Oe=Fe(e))&&De?De.p(e,t):(De.d(1),De=Oe(e),De&&(De.c(),De.m(a,null))),2048&t[0]){let n;for(Ie=X(e[11]),n=0;n<Ie.length;n+=1){const r=Je(e,Ie,n);Re[n]?Re[n].p(r,t):(Re[n]=qe(r),Re[n].c(),Re[n].m(D,null))}for(;n<Re.length;n+=1)Re[n].d(1);Re.length=Ie.length}2056&t[0]&&S(D,e[3]),16&t[0]&&S(W,e[4]),4&t[0]&&(ne.checked=e[2]),32&t[0]&&pe.value!==e[5]&&k(pe,e[5]),512&t[0]&&(ve.checked=e[9]),e[9]?Pe||(Pe=Ve(),Pe.c(),Pe.m(xe,null)):Pe&&(Pe.d(1),Pe=null),Ne!==(Ne=Ue(e))&&(Be.d(1),Be=Ne(e),Be&&(Be.c(),Be.m(Le,null))),1024&t[0]&&(Le.disabled=e[10]),1024&t[0]&&j(Le,"opacity-50",e[10])},i:e,o:e,d(e){e&&m(n),De.d(),p(Re,e),Pe&&Pe.d(),Be.d(),ze=!1,r(Ae)}}}function Ye(e,t,n){let r;a(e,me,e=>n(10,r=e));let o,i,l="file",d=null,u="",m=!1,p="whisper-large-v3",f=10,g="",b={icon:"mdi:file-plus",title:"Drop files here or click to browse",subtitle:"MP3, WAV, M4A, FLAC, etc. (up to 1GB)"},h=!1;const x=[{value:"whisper-large-v3",label:"Whisper Large v3 (Default)"},{value:"whisper-large-v3-turbo",label:"Whisper Large v3 Turbo (Faster)"}];function _(e){n(8,b={icon:"mdi:file-music",title:e.name,subtitle:`Ready to transcribe (${Re(e.size)})`,description:'Click "Transcribe Audio" to start'}),d=e}function v(){n(8,b={icon:"mdi:file-plus",title:"Drop files here or click to browse",subtitle:"MP3, WAV, M4A, FLAC, etc. (up to 1GB)"}),d=null,i&&n(7,i.value="",i)}function y(){o&&(o.classList.remove("border-terminal-accent","bg-green-900/20"),o.classList.add("border-terminal-border"))}function k(){i&&i.click()}function w(e){n(0,l=e),v(),n(1,u="")}return[l,u,m,p,f,g,o,i,b,h,r,x,function(e){e.preventDefault(),o&&(o.classList.add("border-terminal-accent","bg-green-900/20"),o.classList.remove("border-terminal-border"))},y,function(e){e.preventDefault(),y();const t=Array.from(e.dataTransfer.files);t.length>0&&_(t[0])},function(e){const t=Array.from(e.target.files);t.length>0&&_(t[0])},k,async function(){if(!r)if("file"===l)if(d)try{c(me,r=!0,r),n(8,b={icon:"mdi:upload",title:`Uploading ${d.name}...`,subtitle:`${Re(d.size)} - Please wait`}),await new Promise(e=>setTimeout(e,300)),n(8,b={icon:"mdi:loading",title:`Processing ${d.name}...`,subtitle:"Transcribing audio with Groq Whisper"}),await async function(e,t=!1,n=null,r="whisper-large-v3",o=10,i=!1){const l=new FormData;l.append("file",e),l.append("use_llm",t),l.append("model",r),l.append("chunk_size_mb",o.toString()),l.append("debug_save_chunks",i.toString()),n&&l.append("webhook_url",n);const a=await fetch("/upload",{method:"POST",body:l});if(!a.ok){const e=await a.text();throw new Error(e)}const c=await a.json();if(await Be(),c.job_id){const e=c.job_id;console.log("Setting up completion monitoring for direct upload job:",e);const t=setInterval(async()=>{try{console.log("Checking direct upload job completion:",e),await Be();const n=s(ue).find(t=>t.job_id===e);n&&"done"===n.status?(console.log("Direct upload job completed:",e),clearInterval(t),setTimeout(()=>Be(),500)):n&&"failed"===n.status?(console.log("Direct upload job failed:",e),clearInterval(t)):n||(console.log("Direct upload job no longer found, stopping monitoring:",e),clearInterval(t))}catch(e){console.error("Error monitoring job completion:",e)}},2e3);setTimeout(()=>{clearInterval(t),console.log("Stopped monitoring job completion after timeout:",e)},6e5)}return c}(d,m,g||null,p,f,h),n(8,b={icon:"mdi:check",title:`${d.name} uploaded successfully!`,subtitle:"Transcript will automatically refresh when ready.",success:!0}),setTimeout(()=>{v()},3e3)}catch(e){n(8,b={icon:"mdi:alert-circle",title:"Upload failed",subtitle:e.message,error:!0}),setTimeout(()=>{v()},3e3)}finally{c(me,r=!1,r)}else k();else if("url"===l)if(u.trim())try{c(me,r=!0,r),await async function(e,t=!1,n=null,r="whisper-large-v3",o=10,i=!1){const l=await fetch("/upload-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,use_llm:t,webhook_url:n,model:r,chunk_size_mb:o,debug_save_chunks:i})});if(!l.ok){const e=await l.text();throw new Error(e)}const a=await l.json();if(await Be(),a.job_id){const e=a.job_id;console.log("Setting up completion monitoring for URL upload job:",e);const t=setInterval(async()=>{try{console.log("Checking URL upload job completion:",e),await Be();const n=s(ue).find(t=>t.job_id===e);n&&"done"===n.status?(console.log("URL upload job completed:",e),clearInterval(t),setTimeout(()=>Be(),500)):n&&"failed"===n.status?(console.log("URL upload job failed:",e),clearInterval(t)):n||(console.log("URL upload job no longer found, stopping monitoring:",e),clearInterval(t))}catch(e){console.error("Error monitoring job completion:",e)}},2e3);setTimeout(()=>{clearInterval(t),console.log("Stopped monitoring job completion after timeout:",e)},6e5)}return a}(u.trim(),m,g||null,p,f,h),n(1,u="")}catch(e){alert("Upload failed: "+e.message)}finally{c(me,r=!1,r)}else alert("Please enter an audio URL first")},w,()=>w("file"),()=>w("url"),function(e){F[e?"unshift":"push"](()=>{o=e,n(6,o)})},e=>"Enter"===e.key&&k(),function(e){F[e?"unshift":"push"](()=>{i=e,n(7,i)})},function(){u=this.value,n(1,u)},function(){p=$(this),n(3,p),n(11,x)},function(){f=$(this),n(4,f)},function(){m=this.checked,n(2,m)},function(){g=this.value,n(5,g)},function(){h=this.checked,n(9,h)}]}class Ze extends re{constructor(e){super(),ne(this,e,Ye,Qe,i,{},null,[-1,-1])}}function et(e,t,n){const r=e.slice();return r[78]=t[n],r}function tt(e){let t,n,r,o;return{c(){t=f("input"),t.disabled=n=e[2]||e[3],_(t,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),_(t,"type","url"),_(t,"placeholder","https://example.com/audio.mp3"),j(t,"opacity-50",e[2]||e[3])},m(n,i){u(n,t,i),k(t,e[1]),r||(o=x(t,"input",e[34]),r=!0)},p(e,r){12&r[0]&&n!==(n=e[2]||e[3])&&(t.disabled=n),2&r[0]&&t.value!==e[1]&&k(t,e[1]),12&r[0]&&j(t,"opacity-50",e[2]||e[3])},d(e){e&&m(t),r=!1,o()}}}function nt(e){let t,n,o,i,l,s,a,c,p,h,k,w,S,$,C,T=e[11].title+"",L=e[11].subtitle+"",E=e[11].description&&rt(e);return{c(){t=f("div"),n=f("iconify-icon"),i=b(),l=f("div"),s=g(T),a=b(),c=f("div"),p=g(L),h=b(),E&&E.c(),k=b(),w=f("input"),v(n,"icon",o=e[11].icon),v(n,"class","text-3xl mb-2"),j(n,"text-terminal-text-dim",!e[11].success&&!e[11].error),j(n,"text-terminal-accent","mdi:file-music"===e[11].icon),j(n,"animate-spin","mdi:loading"===e[11].icon),_(l,"class","font-bold"),_(c,"class","text-xs"),j(c,"text-terminal-text-dim",!e[11].success&&!e[11].error),j(c,"text-terminal-accent","mdi:file-music"===e[11].icon),_(t,"role","button"),_(t,"tabindex","0"),_(t,"class","border-2 border-dashed border-terminal-border p-6 text-center cursor-pointer transition-all hover:border-terminal-accent hover:bg-gray-900/20"),j(t,"pointer-events-none",e[2]||e[3]),j(t,"opacity-50",e[2]||e[3]),_(w,"type","file"),_(w,"accept","audio/*,video/*"),_(w,"class","hidden"),w.disabled=S=e[2]||e[3]},m(r,o){u(r,t,o),d(t,n),d(t,i),d(t,l),d(l,s),d(t,a),d(t,c),d(c,p),d(t,h),E&&E.m(t,null),e[31](t),u(r,k,o),u(r,w,o),e[33](w),$||(C=[x(t,"click",e[19]),x(t,"keydown",e[32]),x(t,"dragover",e[15]),x(t,"dragleave",e[16]),x(t,"drop",e[17]),x(w,"change",e[18])],$=!0)},p(e,r){2048&r[0]&&o!==(o=e[11].icon)&&v(n,"icon",o),2048&r[0]&&j(n,"text-terminal-text-dim",!e[11].success&&!e[11].error),2048&r[0]&&j(n,"text-terminal-accent","mdi:file-music"===e[11].icon),2048&r[0]&&j(n,"animate-spin","mdi:loading"===e[11].icon),2048&r[0]&&T!==(T=e[11].title+"")&&y(s,T),2048&r[0]&&L!==(L=e[11].subtitle+"")&&y(p,L),2048&r[0]&&j(c,"text-terminal-text-dim",!e[11].success&&!e[11].error),2048&r[0]&&j(c,"text-terminal-accent","mdi:file-music"===e[11].icon),e[11].description?E?E.p(e,r):(E=rt(e),E.c(),E.m(t,null)):E&&(E.d(1),E=null),12&r[0]&&j(t,"pointer-events-none",e[2]||e[3]),12&r[0]&&j(t,"opacity-50",e[2]||e[3]),12&r[0]&&S!==(S=e[2]||e[3])&&(w.disabled=S)},d(n){n&&(m(t),m(k),m(w)),E&&E.d(),e[31](null),e[33](null),$=!1,r(C)}}}function rt(e){let t,n,r=e[11].description+"";return{c(){t=f("div"),n=g(r),_(t,"class","text-xs text-terminal-text-dim")},m(e,r){u(e,t,r),d(t,n)},p(e,t){2048&t[0]&&r!==(r=e[11].description+"")&&y(n,r)},d(e){e&&m(t)}}}function ot(t){let n,r,o=t[78].label+"";return{c(){n=f("option"),r=g(o),n.__value=t[78].value,k(n,n.__value)},m(e,t){u(e,n,t),d(n,r)},p:e,d(e){e&&m(n)}}}function it(e){let t;return{c(){t=g("Real-time streaming for immediate feedback")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function lt(e){let t;return{c(){t=g("Large files uploaded in chunks with parallel processing")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function st(e){let t,n,r,o,i,l,s,a;return{c(){t=f("select"),n=f("option"),n.textContent="0.25MB (Ultra-fast)",r=f("option"),r.textContent="0.5MB (Fast)",o=f("option"),o.textContent="1MB (Balanced)",i=f("option"),i.textContent="2MB (Fewer API calls)",n.__value=.25,k(n,n.__value),r.__value=.5,k(r,r.__value),o.__value=1,k(o,o.__value),i.__value=2,k(i,i.__value),_(t,"id","chunk-size"),t.disabled=l=e[2]||e[3],_(t,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===e[5]&&P(()=>e[39].call(t)),j(t,"opacity-50",e[2]||e[3])},m(l,c){u(l,t,c),d(t,n),d(t,r),d(t,o),d(t,i),S(t,e[5],!0),s||(a=x(t,"change",e[39]),s=!0)},p(e,n){12&n[0]&&l!==(l=e[2]||e[3])&&(t.disabled=l),32&n[0]&&S(t,e[5]),12&n[0]&&j(t,"opacity-50",e[2]||e[3])},d(e){e&&m(t),s=!1,a()}}}function at(e){let t,n,r,o,i,l,s,a,c,p;return{c(){t=f("select"),n=f("option"),n.textContent="5MB (Recommended)",r=f("option"),r.textContent="10MB (Fewer chunks)",o=f("option"),o.textContent="20MB (Very large chunks)",i=f("option"),i.textContent="50MB (Maximum size)",s=b(),a=f("div"),a.innerHTML="💡 <strong>Tip:</strong> Files with lots of metadata (album art, tags) benefit from larger chunks (10MB+) to ensure the first chunk contains enough audio for transcription.",n.__value=5,k(n,n.__value),r.__value=10,k(r,r.__value),o.__value=20,k(o,o.__value),i.__value=50,k(i,i.__value),_(t,"id","chunked-chunk-size"),t.disabled=l=e[2]||e[3],_(t,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===e[6]&&P(()=>e[38].call(t)),j(t,"opacity-50",e[2]||e[3]),_(a,"class","text-xs text-terminal-text-dim mt-1")},m(l,m){u(l,t,m),d(t,n),d(t,r),d(t,o),d(t,i),S(t,e[6],!0),u(l,s,m),u(l,a,m),c||(p=x(t,"change",e[38]),c=!0)},p(e,n){12&n[0]&&l!==(l=e[2]||e[3])&&(t.disabled=l),64&n[0]&&S(t,e[6]),12&n[0]&&j(t,"opacity-50",e[2]||e[3])},d(e){e&&(m(t),m(s),m(a)),c=!1,p()}}}function ct(e){let t;return{c(){t=f("div"),t.textContent="⚠️ Chunks will be saved to R2 debug storage for inspection. \n              Check logs for full R2 URLs to access files directly.",_(t,"class","text-xs text-terminal-text-dim mt-1 ml-6")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function dt(e){let t,n,r;return{c(){t=f("iconify-icon"),n=b(),r=g(e[13]),v(t,"icon","mdi:waveform")},m(e,o){u(e,t,o),u(e,n,o),u(e,r,o)},p(e,t){8192&t[0]&&y(r,e[13])},d(e){e&&(m(t),m(n),m(r))}}}function ut(t){let n,r;return{c(){n=f("iconify-icon"),r=g(" Stop Streaming"),v(n,"icon","mdi:stop")},m(e,t){u(e,n,t),u(e,r,t)},p:e,d(e){e&&(m(n),m(r))}}}function mt(t){let n,i,l,s,a,c,h,w,$,C,T,L,E,M,z,A,F,O,D,I,R,U,N,B,J,W,H,G,q,V,K,Q,Y,Z,ee,te,ne,re,oe,ie,le,se,ae,ce,de,ue,me,pe,fe,ge,be,he,xe,_e,ve,ye,ke,we,Se,$e,je,Ce,Te,Le,Ee,Me,ze,Ae,Fe,Oe,De,Ie,Re,Pe,Ue,Ne,Be,Je,We,He,Ge,qe,Ve,Ke,Xe,Qe,Ye,Ze,rt,mt=t[4]?"Upload chunk size:":"Chunk size:";function pt(e,t){return"file"===e[0]?nt:tt}let ft=pt(t),gt=ft(t),bt=X(t[14]),ht=[];for(let e=0;e<bt.length;e+=1)ht[e]=ot(et(t,bt,e));function xt(e,t){return e[4]?lt:it}let _t=xt(t),vt=_t(t);function yt(e,t){return e[4]?at:st}let kt=yt(t),wt=kt(t),St=t[12]&&ct();function $t(e,t){return e[2]||e[3]?ut:dt}let jt=$t(t),Ct=jt(t);return{c(){n=f("div"),i=f("div"),i.innerHTML='<iconify-icon icon="mdi:waveform" class="text-lg"></iconify-icon> <span>Streaming Transcription</span>',l=b(),s=f("div"),s.textContent="Real-time processing with live transcript streaming. See results as they're generated - perfect for demos and testing.",a=b(),c=f("div"),h=f("div"),h.textContent="Source:",w=b(),$=f("div"),C=f("button"),T=f("iconify-icon"),L=g(" File"),M=b(),z=f("button"),A=f("iconify-icon"),F=g(" URL"),D=b(),gt.c(),I=b(),R=f("div"),U=f("div"),U.textContent="Settings:",N=b(),B=f("div"),J=f("div"),W=f("label"),W.textContent="Whisper model:",H=b(),G=f("select");for(let e=0;e<ht.length;e+=1)ht[e].c();V=b(),K=f("div"),K.innerHTML="💡 <strong>Turbo:</strong> Faster processing, <strong>v3:</strong> Higher accuracy",Q=b(),Y=f("div"),Z=f("label"),Z.textContent="Streaming mode:",ee=b(),te=f("div"),ne=f("button"),re=f("iconify-icon"),oe=g(" Live Streaming"),le=b(),se=f("button"),ae=f("iconify-icon"),ce=g(" Chunked Upload"),ue=b(),me=f("div"),vt.c(),pe=b(),fe=f("div"),ge=f("label"),be=g(mt),he=b(),wt.c(),xe=b(),_e=f("div"),ve=f("label"),ve.textContent="LLM correction:",ye=b(),ke=f("select"),we=f("option"),we.textContent="Disabled (fastest)",Se=f("option"),Se.textContent="Per-chunk (real-time)",$e=f("option"),$e.textContent="Post-process (better quality)",Ce=b(),Te=f("div"),Le=f("label"),Ee=f("input"),Me=b(),ze=f("iconify-icon"),Ae=b(),Fe=f("span"),Fe.textContent="LLM Error Correction",Oe=b(),De=f("span"),De.textContent="(Improves accuracy)",Ie=b(),Re=f("div"),Pe=f("div"),Pe.textContent="🐛 Debug Options",Ue=b(),Ne=f("div"),Be=f("label"),Je=f("input"),We=b(),He=f("iconify-icon"),Ge=b(),qe=f("span"),qe.textContent="Save chunks to debug storage",Ve=b(),Ke=f("span"),Ke.textContent="(For troubleshooting chunk issues)",Xe=b(),St&&St.c(),Qe=b(),Ye=f("button"),Ct.c(),_(i,"class","flex items-center gap-2 mb-4 font-bold text-terminal-accent"),_(s,"class","text-xs text-terminal-text-dim mb-4"),_(h,"class","font-bold mb-2"),v(T,"icon","mdi:file-outline"),C.disabled=E=t[2]||t[3],_(C,"class","border border-terminal-border text-terminal-text px-4 py-2 hover:bg-yellow-400 transition-colors flex-1 flex items-center justify-center gap-2"),j(C,"bg-yellow-400","file"===t[0]),j(C,"bg-terminal-bg","file"!==t[0]),j(C,"opacity-50",t[2]||t[3]),v(A,"icon","mdi:web"),z.disabled=O=t[2]||t[3],_(z,"class","border border-terminal-border text-terminal-text px-4 py-2 hover:bg-yellow-400 transition-colors flex-1 flex items-center justify-center gap-2"),j(z,"bg-yellow-400","url"===t[0]),j(z,"bg-terminal-bg","url"!==t[0]),j(z,"opacity-50",t[2]||t[3]),_($,"class","flex gap-2 mb-3"),_(c,"class","mb-4"),_(U,"class","font-bold mb-2"),_(W,"for","model-select-streaming"),_(W,"class","text-terminal-text-dim block mb-1"),_(G,"id","model-select-streaming"),G.disabled=q=t[2]||t[3],_(G,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===t[8]&&P(()=>t[35].call(G)),j(G,"opacity-50",t[2]||t[3]),_(K,"class","text-xs text-terminal-text-dim mt-1"),_(Z,"class","text-terminal-text-dim block mb-1"),v(re,"icon","mdi:waveform"),_(ne,"type","button"),ne.disabled=ie=t[2]||t[3],_(ne,"class","border border-terminal-border text-terminal-text px-3 py-2 flex-1 hover:bg-yellow-400 transition-colors flex items-center justify-center gap-2"),j(ne,"bg-yellow-400",!t[4]),j(ne,"bg-terminal-bg",t[4]),j(ne,"opacity-50",t[2]||t[3]),v(ae,"icon","mdi:package-variant"),_(se,"type","button"),se.disabled=de=t[2]||t[3],_(se,"class","border border-terminal-border text-terminal-text px-3 py-2 flex-1 hover:bg-yellow-400 transition-colors flex items-center justify-center gap-2"),j(se,"bg-yellow-400",t[4]),j(se,"bg-terminal-bg",!t[4]),j(se,"opacity-50",t[2]||t[3]),_(te,"class","flex gap-2"),_(me,"class","text-xs text-terminal-text-dim mt-1"),_(ge,"for","chunk-size"),_(ge,"class","text-terminal-text-dim block mb-1"),_(ve,"for","llm-mode"),_(ve,"class","text-terminal-text-dim block mb-1"),we.__value="disabled",k(we,we.__value),Se.__value="per_chunk",k(Se,Se.__value),$e.__value="post_process",k($e,$e.__value),_(ke,"id","llm-mode"),ke.disabled=je=t[2]||t[3],_(ke,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-2 w-full focus:outline-none focus:border-terminal-accent"),void 0===t[7]&&P(()=>t[40].call(ke)),j(ke,"opacity-50",t[2]||t[3]),_(Ee,"type","checkbox"),_(Ee,"class","w-4 h-4"),v(ze,"icon","mdi:brain"),v(ze,"class","text-terminal-accent"),_(Fe,"class","text-terminal-accent"),_(De,"class","text-terminal-text-dim"),_(Le,"class","flex items-center gap-2 cursor-pointer"),_(Pe,"class","text-terminal-text font-bold mb-2 text-sm"),_(Je,"type","checkbox"),_(Je,"class","w-4 h-4"),v(He,"icon","mdi:folder-download"),v(He,"class","text-terminal-text-dim"),_(qe,"class","text-terminal-text"),_(Ke,"class","text-terminal-text-dim text-xs"),_(Be,"class","flex items-center gap-2 cursor-pointer"),_(Re,"class","border border-terminal-border p-2"),_(B,"class","space-y-3"),_(R,"class","mb-4 flex-1"),_(Ye,"class","px-4 py-2 transition-colors w-full font-bold flex items-center justify-center gap-2"),j(Ye,"bg-status-info",!t[2]&&!t[3]),j(Ye,"bg-status-error",t[2]||t[3]),j(Ye,"text-terminal-bg",!t[2]&&!t[3]||t[2]||t[3]),j(Ye,"hover:bg-blue-500",!t[2]&&!t[3]),j(Ye,"hover:bg-red-600",t[2]||t[3]),_(n,"class","border border-terminal-border p-4 flex flex-col")},m(e,r){u(e,n,r),d(n,i),d(n,l),d(n,s),d(n,a),d(n,c),d(c,h),d(c,w),d(c,$),d($,C),d(C,T),d(C,L),d($,M),d($,z),d(z,A),d(z,F),d(c,D),gt.m(c,null),d(n,I),d(n,R),d(R,U),d(R,N),d(R,B),d(B,J),d(J,W),d(J,H),d(J,G);for(let e=0;e<ht.length;e+=1)ht[e]&&ht[e].m(G,null);S(G,t[8],!0),d(J,V),d(J,K),d(B,Q),d(B,Y),d(Y,Z),d(Y,ee),d(Y,te),d(te,ne),d(ne,re),d(ne,oe),d(te,le),d(te,se),d(se,ae),d(se,ce),d(Y,ue),d(Y,me),vt.m(me,null),d(B,pe),d(B,fe),d(fe,ge),d(ge,be),d(fe,he),wt.m(fe,null),d(B,xe),d(B,_e),d(_e,ve),d(_e,ye),d(_e,ke),d(ke,we),d(ke,Se),d(ke,$e),S(ke,t[7],!0),d(B,Ce),d(B,Te),d(Te,Le),d(Le,Ee),Ee.checked=t[12],d(Le,Me),d(Le,ze),d(Le,Ae),d(Le,Fe),d(Le,Oe),d(Le,De),d(B,Ie),d(B,Re),d(Re,Pe),d(Re,Ue),d(Re,Ne),d(Ne,Be),d(Be,Je),Je.checked=t[12],d(Be,We),d(Be,He),d(Be,Ge),d(Be,qe),d(Be,Ve),d(Be,Ke),d(Ne,Xe),St&&St.m(Ne,null),d(n,Qe),d(n,Ye),Ct.m(Ye,null),Ze||(rt=[x(C,"click",t[29]),x(z,"click",t[30]),x(G,"change",t[35]),x(ne,"click",t[36]),x(se,"click",t[37]),x(ke,"change",t[40]),x(Ee,"change",t[41]),x(Je,"change",t[42]),x(Ye,"click",function(){o(t[2]||t[3]?t[22]:t[21])&&(t[2]||t[3]?t[22]:t[21]).apply(this,arguments)})],Ze=!0)},p(e,n){if(t=e,12&n[0]&&E!==(E=t[2]||t[3])&&(C.disabled=E),1&n[0]&&j(C,"bg-yellow-400","file"===t[0]),1&n[0]&&j(C,"bg-terminal-bg","file"!==t[0]),12&n[0]&&j(C,"opacity-50",t[2]||t[3]),12&n[0]&&O!==(O=t[2]||t[3])&&(z.disabled=O),1&n[0]&&j(z,"bg-yellow-400","url"===t[0]),1&n[0]&&j(z,"bg-terminal-bg","url"!==t[0]),12&n[0]&&j(z,"opacity-50",t[2]||t[3]),ft===(ft=pt(t))&&gt?gt.p(t,n):(gt.d(1),gt=ft(t),gt&&(gt.c(),gt.m(c,null))),16384&n[0]){let e;for(bt=X(t[14]),e=0;e<bt.length;e+=1){const r=et(t,bt,e);ht[e]?ht[e].p(r,n):(ht[e]=ot(r),ht[e].c(),ht[e].m(G,null))}for(;e<ht.length;e+=1)ht[e].d(1);ht.length=bt.length}12&n[0]&&q!==(q=t[2]||t[3])&&(G.disabled=q),16640&n[0]&&S(G,t[8]),12&n[0]&&j(G,"opacity-50",t[2]||t[3]),12&n[0]&&ie!==(ie=t[2]||t[3])&&(ne.disabled=ie),16&n[0]&&j(ne,"bg-yellow-400",!t[4]),16&n[0]&&j(ne,"bg-terminal-bg",t[4]),12&n[0]&&j(ne,"opacity-50",t[2]||t[3]),12&n[0]&&de!==(de=t[2]||t[3])&&(se.disabled=de),16&n[0]&&j(se,"bg-yellow-400",t[4]),16&n[0]&&j(se,"bg-terminal-bg",!t[4]),12&n[0]&&j(se,"opacity-50",t[2]||t[3]),_t!==(_t=xt(t))&&(vt.d(1),vt=_t(t),vt&&(vt.c(),vt.m(me,null))),16&n[0]&&mt!==(mt=t[4]?"Upload chunk size:":"Chunk size:")&&y(be,mt),kt===(kt=yt(t))&&wt?wt.p(t,n):(wt.d(1),wt=kt(t),wt&&(wt.c(),wt.m(fe,null))),12&n[0]&&je!==(je=t[2]||t[3])&&(ke.disabled=je),128&n[0]&&S(ke,t[7]),12&n[0]&&j(ke,"opacity-50",t[2]||t[3]),4096&n[0]&&(Ee.checked=t[12]),4096&n[0]&&(Je.checked=t[12]),t[12]?St||(St=ct(),St.c(),St.m(Ne,null)):St&&(St.d(1),St=null),jt===(jt=$t(t))&&Ct?Ct.p(t,n):(Ct.d(1),Ct=jt(t),Ct&&(Ct.c(),Ct.m(Ye,null))),12&n[0]&&j(Ye,"bg-status-info",!t[2]&&!t[3]),12&n[0]&&j(Ye,"bg-status-error",t[2]||t[3]),12&n[0]&&j(Ye,"text-terminal-bg",!t[2]&&!t[3]||t[2]||t[3]),12&n[0]&&j(Ye,"hover:bg-blue-500",!t[2]&&!t[3]),12&n[0]&&j(Ye,"hover:bg-red-600",t[2]||t[3])},i:e,o:e,d(e){e&&m(n),gt.d(),p(ht,e),vt.d(),wt.d(),St&&St.d(),Ct.d(),Ze=!1,r(rt)}}}function pt(e,t,n){let r,o,i,l,d,u,m,p,f,g,b,h,x,_,v,y,k,w,S,j,C,T,L,E;a(e,pe,e=>n(2,o=e)),a(e,we,e=>n(3,i=e)),a(e,ge,e=>n(26,l=e)),a(e,xe,e=>n(47,d=e)),a(e,he,e=>n(48,u=e)),a(e,_e,e=>n(49,m=e)),a(e,ve,e=>n(50,p=e)),a(e,ye,e=>n(51,f=e)),a(e,ke,e=>n(52,g=e)),a(e,fe,e=>n(53,b=e)),a(e,Le,e=>n(54,h=e)),a(e,Ce,e=>n(55,x=e)),a(e,Se,e=>n(56,_=e)),a(e,Te,e=>n(27,v=e)),a(e,Ae,e=>n(57,y=e)),a(e,Oe,e=>n(58,k=e)),a(e,Fe,e=>n(59,w=e)),a(e,ze,e=>n(28,S=e)),a(e,De,e=>n(60,j=e)),a(e,Me,e=>n(61,C=e)),a(e,Ee,e=>n(62,T=e)),a(e,be,e=>n(63,L=e)),a(e,$e,e=>n(4,E=e));let M,z,A="file",O=null,D="",I=10,R=5,P="disabled",U="whisper-large-v3",N={icon:"mdi:file-plus",title:"Drop files here or click to browse",subtitle:"MP3, WAV, M4A, FLAC, etc. (up to 1GB)"};const B=[{value:"whisper-large-v3",label:"Whisper Large v3 (Default)"},{value:"whisper-large-v3-turbo",label:"Whisper Large v3 Turbo (Faster)"}];let J=null,W=null,H=null,G="",q=0,V=!1;function K(e){const t=E?"chunked":"streaming",r=E?'Click "Chunked Stream" to upload in chunks with real-time processing':'Click "Live Transcribe" to start',o=e.name.split(".").pop().toLowerCase();let i="",l="mdi:file-music";["mp4","mov","avi","mkv","webm"].includes(o)?(i="⚠️ Video file detected. Audio will be extracted for transcription.",l="mdi:file-video"):["mp3","wav","flac","m4a","ogg","webm"].includes(o)||(i="⚠️ Unusual file format. Transcription may fail.",l="mdi:file-question"),n(11,N={icon:l,title:e.name,subtitle:`Ready to ${t} transcribe (${Re(e.size)})`,description:i||r}),n(23,O=e)}function X(){M&&(M.classList.remove("border-terminal-accent","bg-green-900/20"),M.classList.add("border-terminal-border"))}function Q(){z&&z.click()}function Y(e){n(0,A=e),"file"===e&&(n(11,N={icon:"mdi:file-plus",title:"Drop files here or click to browse",subtitle:"MP3, WAV, M4A, FLAC, etc. (up to 1GB)"}),n(23,O=null),z&&n(10,z.value="",z))}function Z(){c(be,L=Date.now(),L),W=setInterval(()=>{n(25,q++,q)},1e3)}function ee(){W&&(clearInterval(W),W=null)}function te(e){try{console.log("🔄 SSE Event received:",e.data);const t=JSON.parse(e.data);console.log("📡 Parsed SSE data:",t),async function(e){switch(console.log("🎯 Processing SSE event:",e.type,e),e.type){case"initialized":c(Me,C=e.total_chunks,C),de.info("Chunked upload initialized",{parent_job_id:e.parent_job_id,total_chunks:e.total_chunks}),e.total_size&&e.total_size>0&&!j&&c(De,j=Re(e.total_size),j);break;case"progress_update":console.log("📊 SSE Progress update received:",{upload:e.upload_progress,processing:e.processing_progress,overall:e.progress,uploaded_chunks:e.uploaded_chunks,completed_chunks:e.completed_chunks});const t=s(Te),r=S;console.log("📊 Current vs SSE progress:",{current:{upload:t.upload,processing:t.processing,overall:t.overall,uploaded_chunks:r},sse:{upload:e.upload_progress,processing:e.processing_progress,overall:e.progress,uploaded_chunks:e.uploaded_chunks}});const o=(e.upload_progress||0)>0?Math.max(t.upload||0,e.upload_progress):t.upload||0,l=(e.processing_progress||0)>0?Math.max(t.processing||0,e.processing_progress):t.processing||0,a=(e.progress||0)>0?Math.max(t.overall||0,e.progress):t.overall||0,d=(e.uploaded_chunks||0)>=0?Math.max(r||0,e.uploaded_chunks):r||0;Math.abs(o-(t.upload||0))>0||Math.abs(l-(t.processing||0))>0||Math.abs(a-(t.overall||0))>0||Math.abs(d-(r||0))>0?(console.log("📊 Updating progress stores:",{from:t,to:{upload:o,processing:l,overall:a},uploadedChunks:{from:r,to:d}}),c(Te,v={upload:o,processing:l,overall:a},v),c(ze,S=d,S),c(Ae,y=e.completed_chunks||y,y),c(Fe,w=e.failed_chunks||w,w),c(Oe,k=e.success_rate||k,k)):console.log("📊 Skipping SSE progress update - no significant change detected");break;case"chunk_complete":console.log("🎯 Chunk completed:",e),Ue(e.chunk_index,{status:"complete",text:e.text||e.transcript,rawText:e.raw_text||e.text||e.transcript,correctedText:e.corrected_text,llmApplied:e.llm_applied||!1,processingTime:e.processing_time||0,completedAt:(new Date).toISOString(),arrivalOrder:(y||0)+1}),c(Ae,y=(y||0)+1,y),updateProgress(),re();break;case"chunk_skipped":console.log("⏭️ Chunk skipped:",e),Ue(e.chunk_index,{status:"skipped",text:"",rawText:"",correctedText:"",llmApplied:!1,processingTime:0,completedAt:(new Date).toISOString(),skipReason:e.reason,arrivalOrder:(y||0)+1}),c(Ae,y=(y||0)+1,y),0===e.chunk_index&&console.log("📋 Chunk 0 skipped: This is normal for files with metadata/headers"),updateProgress(),re();break;case"chunk_failed":console.error("❌ Chunk failure received:",{chunk_index:e.chunk_index,error:e.error}),Ue(e.chunk_index,{status:"failed",error:e.error});break;case"partial_transcript":c(Le,h=e.partial_transcript,h);break;case"final_result":console.log("🏁 Final result received:",{success_rate:e.success_rate,transcript_length:e.final_transcript?.length||0,failed_chunks:e.failed_chunks,successful_chunks:e.successful_chunks}),e.final_transcript&&""!==e.final_transcript.trim()||(console.error("❌ Final result has empty transcript!"),alert("Transcription completed but no text was generated. This may be due to audio format issues or silent audio.")),c(Te,v={upload:100,processing:100,overall:100},v);const u=s(ue),m=u.findIndex(t=>t.job_id===e.parent_job_id);-1!==m&&(u[m]={...u[m],status:"done",final_transcript:e.final_transcript,raw_transcript:e.raw_transcript,corrected_transcript:e.corrected_transcript,completed_at:(new Date).toISOString(),progress:100,success_rate:e.success_rate,transcripts:[{text:e.final_transcript,raw_text:e.raw_transcript,segments:[],start:0,duration:u[m].file_size||0,chunk_index:"chunked_streaming"}]},ue.set(u)),de.complete("Chunked streaming completed",{parent_job_id:e.parent_job_id,success_rate:e.success_rate,transcript_length:e.final_transcript?.length||0}),setTimeout(async()=>{try{await Be(),de.info("Jobs refreshed after chunked streaming completion")}catch(e){de.error("Failed to refresh jobs after chunked streaming",e)}},1e3),c(Se,_=!0,_),c(we,i=!1,i),n(24,G=""),H&&(de.info("Closing chunked stream after completion",{readyState:H.readyState}),H.onmessage=null,H.onerror=null,H.onopen=null,H.close(),H=null),ee(),setTimeout(()=>{"url"===A&&n(1,D="")},2e3);break;case"job_terminated":console.error("💀 Job terminated:",{reason:e.reason,status:e.status,partial_results:e.partial_results}),de.error("Chunked job terminated",{reason:e.reason,status:e.status}),e.reason&&e.reason.includes("No valid chunks")&&alert("Transcription failed: No valid audio chunks found. This may be due to:\n• Unsupported audio format\n• Silent or corrupted audio\n• Audio encoding issues\n\nTry converting to MP3 or WAV format."),oe();break;case"stream_error":console.error("🚨 Stream error received:",e),e.error&&e.error.includes("No valid chunks")&&alert("Stream error: No valid chunks found for transcription. Check the console for details.");break;default:console.log("🤷 Unknown SSE event type:",e.type,e)}}(t)}catch(t){console.error("Failed to parse chunked SSE data:",t,e.data)}}function ne(e){if(console.log("❌ Chunked SSE error event:",e),console.log("🔌 SSE readyState:",H?.readyState),console.log("🔄 Is still streaming?",i),H&&H.readyState===EventSource.CLOSED)return de.info("Chunked stream closed after completion",{readyState:H.readyState}),void(i&&(de.warn("Chunked stream closed unexpectedly while still processing"),console.warn("⚠️ Stream closed but still expecting updates - this might indicate a connection issue")));de.error("Chunked stream error",e),console.error("❌ Chunked SSE error:",e),i&&(console.error("💥 Stream connection lost during active streaming"),setTimeout(()=>{!i||H&&H.readyState!==EventSource.CLOSED||alert("Stream connection lost. Check console for details. The upload may still be processing.")},5e3))}function re(){const e=s(je);let t="";for(let n=0;n<e.length;n++){const r=e[n];if(!r||"complete"!==r.status||!r.text)break;t+=(t?" ":"")+("speed"===x&&r.correctedText?r.correctedText:r.text)}c(Le,h=t,h)}function oe(){H&&(de.info("Closing chunked stream",{readyState:H.readyState}),H.onmessage=null,H.onerror=null,H.onopen=null,H.close(),H=null),c(we,i=!1,i),ee(),n(24,G=""),setTimeout(()=>{"url"===A&&n(1,D="")},2e3)}async function ie(e){const t=s(ue),n=t.find(e=>"streaming"===e.processing_method&&e.filename===l&&"processing"===e.status);switch(e.type){case"status":c(xe,d+=`📡 ${e.message}\n`,d),n&&e.job_id&&n.job_id.startsWith("stream_")&&(n.job_id=e.job_id,n.file_size=e.total_size,n.estimated_chunks=e.estimated_chunks,ue.set(t)),e.total_size&&c(ye,f=Re(e.total_size),f);break;case"chunk_info":c(ve,p=e.total_chunks,p),c(xe,d+=`🧩 Ready to process ${e.total_chunks} chunks (${e.chunk_size_mb}MB each)\n\n`,d);break;case"chunk_start":c(he,u=e.progress,u),c(xe,d+=`🔄 Chunk ${e.chunk_index+1} (${e.progress}%) - transcribing...\n`,d),n&&(n.progress=e.progress,ue.set(t));break;case"delta":if(e.llm_applied)c(xe,d+=`📝 Raw: "${e.raw_text}"\n`,d),c(xe,d+=`🧠 LLM: "${e.corrected_text}"\n\n`,d);else if(e.llm_error)c(xe,d+=`📝 "${e.raw_text}"\n`,d),c(xe,d+=`⚠️  LLM failed: ${e.llm_error}\n\n`,d);else{const t=e.text||e.raw_text;c(xe,d+=`📝 "${t}"\n\n`,d)}c(_e,m+=1,m);break;case"chunk_done":c(he,u=e.progress,u),c(xe,d+=`✅ Chunk ${e.chunk_index+1} completed (${e.progress}%)\n\n`,d);break;case"chunk_error":c(xe,d+=`❌ Chunk ${e.chunk_index+1} error: ${e.error}\n\n`,d);break;case"llm_processing":const r="post_process"===e.mode?"post-processing":"per-chunk";c(xe,d+=`🧠 ${e.message||`Applying LLM corrections (${r})...`}\n`,d);break;case"llm_done":const o="post_process"===e.mode?"Post-processing":"Per-chunk";c(xe,d+=`✅ ${o} LLM correction completed\n`,d),"post_process"===e.mode&&c(xe,d+=`📝 Improved transcript:\n"${e.corrected_text}"\n\n`,d);break;case"llm_error":const i="post_process"===e.mode?"Post-processing":"Per-chunk";c(xe,d+=`❌ ${i} LLM correction failed: ${e.error}\n`,d),e.fallback_text&&c(xe,d+=`📝 Using original transcript: "${e.fallback_text}"\n\n`,d);break;case"done":c(xe,d+="\n🎉 Transcription complete!\n",d),c(xe,d+=`📊 Final transcript: "${e.final_transcript}"\n`,d);const s=t.find(e=>"streaming"===e.processing_method&&e.filename===l&&"processing"===e.status);if(s){s.status="done",s.final_transcript=e.final_transcript,s.raw_transcript=e.raw_transcript,s.corrected_transcript=e.corrected_transcript,s.total_segments=e.total_segments,s.completed_at=(new Date).toISOString(),s.progress=100,s.transcripts=[{text:e.final_transcript,raw_text:e.raw_transcript,segments:[],start:0,duration:s.file_size||0,chunk_index:"streaming"}],ue.set(t);try{await async function(e){try{if(!(await fetch("/save-streaming-job",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e.job_id,filename:e.filename,file_size:e.file_size,final_transcript:e.final_transcript,raw_transcript:e.raw_transcript,corrected_transcript:e.corrected_transcript,total_segments:e.total_segments,created_at:e.created_at,completed_at:e.completed_at,use_llm:e.use_llm,llm_mode:e.llm_mode,chunk_size_mb:e.chunk_size_mb,source_url:e.source_url||null,transcripts:e.transcripts||[]})})).ok)throw new Error("Failed to save streaming job");ce.info("api","Saved streaming job to server",{job_id:e.job_id})}catch(e){ce.error("Failed to save streaming job to server",e)}}(s),de.info("Saved streaming job to server",{job_id:s.job_id}),setTimeout(async()=>{try{await Be(),de.info("Jobs refreshed after streaming completion")}catch(e){de.error("Failed to refresh jobs after streaming",e)}},1e3)}catch(e){de.error("Failed to save streaming job to server",e),setTimeout(async()=>{try{await Be(),de.info("Attempted jobs refresh after save failure")}catch(e){de.error("Failed to refresh jobs after save failure",e)}},1e3)}de.complete("Streaming job completed",{job_id:s.job_id,filename:l,transcript_length:e.final_transcript?.length||0})}break;case"error":c(xe,d+=`\n❌ Error: ${e.error}\n`,d);const a=t.find(e=>"streaming"===e.processing_method&&e.filename===l&&"processing"===e.status);a&&(a.status="failed",a.error=e.error,a.failed_at=(new Date).toISOString(),ue.set(t))}}function le(){J&&(J.abort(),J=null),c(pe,o=!1,o),ee(),setTimeout(()=>{"url"===A&&n(1,D="")},2e3)}"undefined"!=typeof window&&window.addEventListener("chunk-progress-update",e=>{console.log("📊 Received progress update event:",e.detail),n(25,q++,q)});return e.$$.update=()=>{8388608&e.$$.dirty[0]&&O&&K(O),8388624&e.$$.dirty[0]&&O&&void 0!==E&&K(O),436207616&e.$$.dirty[0]&&(S||v||q)&&console.log("🔄 UI Reactive update triggered:",{uploadedChunks:S,progress:v,forceUIUpdate:q,timestamp:Date.now()}),92274719&e.$$.dirty[0]&&n(13,r=(()=>{if(o||i){return`🔄 ${i?"Chunked Streaming":"Streaming"} ${i?G:l}...`}return("file"===A?O:D.trim())?E?"Start Chunked Streaming":"Start Live Streaming":"file"===A?"Select Audio File":"Enter Audio URL"})())},[A,D,o,i,E,I,R,P,U,M,z,N,V,r,B,function(e){e.preventDefault(),M&&(M.classList.add("border-terminal-accent","bg-green-900/20"),M.classList.remove("border-terminal-border"))},X,function(e){e.preventDefault(),X();const t=Array.from(e.dataTransfer.files);if(t.length>0){const e=t[0];n(23,O=e),K(e)}},function(e){const t=Array.from(e.target.files);if(t.length>0){const e=t[0];n(23,O=e),K(e)}},Q,Y,function(){E?(we.set(!1),Se.set(!1),je.set([]),Le.set(""),Ee.set(""),Me.set(0),ze.set(0),Ae.set(0),Fe.set(0),Oe.set(0),De.set(""),Te.set({upload:0,processing:0,overall:0}),Pe=0):c(fe,b=!1,b),setTimeout(()=>{E?async function(){if(i)return;const e={filename:"file"===A?O.name:D.split("/").pop()||"audio",file:"file"===A?O:null,url:"url"===A?D:null,chunkSizeMB:I,useLLM:"disabled"!==P,llmMode:P,model:model,debugSaveChunks:V};"disabled"!==P&&(e.llmMode=P);if("file"===A){if(!O)return void Q();e.filename=O.name,e.file=O}else if("url"===A){if(!D.trim())return void alert("Please enter an audio URL first");e.url=D.trim(),e.filename=D.split("/").pop()||"audio file"}try{const t=await async function(e){const{filename:t,file:n,url:r,chunkSizeMB:o=10,useLLM:i=!1,llmMode:l="per_chunk",model:s="whisper-large-v3",debugSaveChunks:a=!1}=e;if(n){const e=new FormData;e.append("file",n),e.append("chunk_size_mb",o.toString()),e.append("use_llm",i.toString()),e.append("model",s),e.append("debug_save_chunks",a.toString()),i&&e.append("llm_mode",l);const t=await fetch("/chunked-upload-stream",{method:"POST",body:e});if(!t.ok){const e=await t.text();throw new Error(`Failed to initialize chunked upload: ${e}`)}const r=await t.json();return console.log("✅ Server-side audio-aware chunking completed:",{total_chunks:r.chunk_info.total_chunks,chunking_method:r.chunk_info.chunking_method,playable_chunks:r.chunk_info.playable_chunks}),r}if(r){const e={filename:t,url:r,chunk_size_mb:o,use_llm:i,model:s,debug_save_chunks:a};i&&(e.llm_mode=l);const n=await fetch("/chunked-upload-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.text();throw new Error(`Failed to initialize chunked upload: ${e}`)}return await n.json()}throw new Error("Either file or url must be provided")}(e);c(we,i=!0,i),c(Se,_=!0,_),c(Ee,T=t.parent_job_id,T),c(Me,C=t.chunk_info.total_chunks,C),n(24,G=e.filename),O?c(De,j=Re(O.size),j):t.job&&t.job.file_size&&c(De,j=Re(t.job.file_size),j),function(e){const t=Array(e).fill(null).map((e,t)=>({chunkIndex:t,status:"pending",text:"",rawText:"",correctedText:"",processingTime:null,completedAt:null,arrivalOrder:null,uploadProgress:0,error:null,llmApplied:!1,segments:[]}));je.set(t)}(t.chunk_info.total_chunks),c(Te,v={upload:0,processing:0,overall:0},v),c(ze,S=0,S),c(Ae,y=0,y),c(Fe,w=0,w),c(Oe,k=0,k),console.log("🎬 Chunked streaming initialized with progress reset"),Z(),console.log("🌊 Starting SSE stream for job:",t.parent_job_id),H=await async function(e){return new EventSource(`/chunked-stream/${e}`)}(t.parent_job_id),H.onopen=function(e){console.log("✅ SSE connection opened:",e)},H.onmessage=te,H.onerror=ne,setTimeout(()=>{H&&H.readyState===EventSource.CONNECTING?console.warn("⚠️ SSE connection still connecting after 5 seconds"):H&&H.readyState===EventSource.CLOSED?console.warn("⚠️ SSE connection closed unexpectedly"):console.log("✅ SSE connection status:",H?.readyState===EventSource.OPEN?"OPEN":"OTHER")},5e3);const r=setInterval(()=>{if(!H||H.readyState===EventSource.CLOSED)return console.log("🔌 SSE connection lost, cleaning up health check"),void clearInterval(r);H.readyState===EventSource.CONNECTING?console.warn("⚠️ SSE still connecting..."):H.readyState===EventSource.OPEN&&console.log("💓 SSE connection healthy")},1e4);if(e.file)if(t.message&&t.message.includes("audio-aware processing"))console.log("✅ Server-side audio-aware chunking completed, skipping client-side upload"),console.log("📊 Chunking results:",{total_chunks:t.chunk_info.total_chunks,chunking_method:t.chunk_info.chunking_method,playable_chunks:t.chunk_info.playable_chunks}),de.info("Audio-aware chunking completed on server",{total_chunks:t.chunk_info.total_chunks,chunking_method:t.chunk_info.chunking_method});else{if(!t.upload_urls)return console.error("Unexpected response format - no upload URLs or processing confirmation"),alert("Unexpected server response format"),void oe();console.log("⚠️ Using legacy client-side chunking mode");try{const n=await async function(e,t,n,r=3){if(console.log("uploadChunksInParallel called:",{fileSize:e.size,uploadUrlsLength:t?.length,parentJobId:n,maxConcurrent:r}),!t||0===t.length)throw new Error("No upload URLs provided");const o={completed:0,total:t.length,updateProgress(){this.completed++,console.log(`📊 Local upload tracker: ${this.completed}/${this.total} completed`),console.log("📊 Letting SSE handle all progress updates to avoid race conditions");const e=new CustomEvent("chunk-upload-complete",{detail:{uploaded:this.completed,total:this.total}});return"undefined"!=typeof window&&window.dispatchEvent(e),this.completed}},i=t.map(async(t,r)=>{console.log(`Starting upload for chunk ${r}:`,{chunkIndex:t.chunk_index,byteRange:t.byte_range,uploadUrl:t.upload_url,parentJobId:t.parent_job_id});const i=t.byte_range[0],l=t.byte_range[1]+1;if(i<0||l>e.size||i>=l)throw new Error(`Invalid byte range for chunk ${t.chunk_index}: [${i}, ${l}) with file size ${e.size}`);const s=e.slice(i,l);if(0===t.chunk_index){console.log("🔍 Chunk 0 detailed analysis:",{originalFileSize:e.size,originalFileType:e.type,chunkStart:i,chunkEnd:l,sliceLength:l-i,actualChunkSize:s.size,expectedSize:t.expected_size});const n=new FileReader,r=await new Promise((e,t)=>{n.onload=t=>e(new Uint8Array(t.target.result)),n.onerror=t,n.readAsArrayBuffer(s.slice(0,Math.min(64,s.size)))}),o=Array.from(r).filter(e=>0===e).length,a=o/r.length*100;console.log("🔍 Chunk 0 content analysis:",{first64Bytes:Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join(" "),zeroCount:o,zeroPercentage:a.toFixed(1),suspicious:a>25}),a>25&&console.warn(`⚠️ Chunk 0 has ${a.toFixed(1)}% zeros - possible corruption!`)}console.log(`Chunk ${r} data:`,{chunkIndex:t.chunk_index,chunkSize:s.size,expectedStart:i,expectedEnd:l,expectedSize:t.expected_size,sizeMatch:s.size===t.expected_size});try{console.log(`Uploading chunk ${t.chunk_index} to Worker...`);const r=new Blob([s],{type:e.type||"audio/mpeg"});0===t.chunk_index&&console.log("🔍 Chunk 0 FormData details:",{originalFileType:e.type,chunkBlobType:r.type,chunkBlobSize:r.size,chunkSize:s.size,sizesMatch:r.size===s.size});const i=new FormData;i.append("chunk",r,`chunk.${t.chunk_index}.${function(e){const t=e.split(".").pop()?.toLowerCase();return t||"mp3"}(e.name||"audio.mp3")}`),i.append("parent_job_id",n),i.append("chunk_index",t.chunk_index.toString()),i.append("expected_size",t.expected_size.toString());const l=await fetch(Ie+t.upload_url,{method:"POST",body:i});if(console.log(`Chunk ${t.chunk_index} upload response:`,{status:l.status,statusText:l.statusText,ok:l.ok}),!l.ok){const e=await l.json().catch(()=>({error:"Unknown error"}));throw new Error(`Upload failed: ${l.status} ${l.statusText} - ${e.error||"Unknown error"}`)}const a=await l.json();return console.log(`Chunk ${t.chunk_index} completed successfully:`,a),o.updateProgress(),console.log(`📊 Updating chunk slot ${t.chunk_index} to processing`),Ue(t.chunk_index,{status:"processing",uploadProgress:100}),{chunkIndex:t.chunk_index,success:!0,size:s.size,response:a}}catch(e){return console.error(`Chunk ${t.chunk_index} failed:`,e),{chunkIndex:t.chunk_index,success:!1,error:e.message}}});console.log(`Starting ${i.length} concurrent uploads...`);const l=await Promise.allSettled(i);console.log("All upload promises settled:",l);const s=l.map(e=>"fulfilled"===e.status?e.value:{success:!1,error:e.reason?.message||"Upload failed"});return console.log("Final upload results:",s),s}(e.file,t.upload_urls,t.parent_job_id,3),r=n.filter(e=>!e.success);r.length>0&&(console.error("Some chunks failed to upload:",r),de.error("Some chunks failed to upload",{failures:r}))}catch(e){return console.error("Upload chunks failed:",e),de.error("Upload chunks failed",e),alert(`Upload failed: ${e.message}`),void oe()}}else console.log("URL upload - processing handled by server")}catch(e){de.error("Chunked streaming failed",e),console.error("Chunked streaming error:",e),alert(`Chunked streaming failed: ${e.message}`),oe()}}():async function(){if(o)return;let e,t;if("file"===A){if(!O)return void Q();t=O.name;const n=new FormData;n.append("file",O),n.append("chunk_size_mb",I.toString()),n.append("model",U),"disabled"!==P?(n.append("use_llm","true"),n.append("llm_mode",P)):n.append("use_llm","false"),e={method:"POST",body:n}}else if("url"===A){if(!D.trim())return void alert("Please enter an audio URL first");t=D.split("/").pop()||"audio file";const n={url:D.trim(),chunk_size_mb:I,model:U};"disabled"!==P?(n.use_llm=!0,n.llm_mode=P):n.use_llm=!1,e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}}await async function(e,t,n){if(o)return;c(pe,o=!0,o),c(fe,b=!0,b),c(ge,l=n,l),c(xe,d="",d),c(he,u=0,u),c(_e,m=0,m),c(ve,p=0,p),c(ye,f="",f),c(ke,g=P,g),Z();const r={job_id:"stream_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),filename:n,status:"processing",file_size:0,processing_method:"streaming",upload_method:"streaming",created_at:(new Date).toISOString(),use_llm:"disabled"!==P,llm_mode:P,chunk_size_mb:I,progress:0},i=s(ue);ue.set([r,...i]),J=new AbortController,t.signal=J.signal,c(xe,d="🚀 Starting transcription...\n\n",d);try{const n=await fetch(e,t);if(!n.ok)throw new Error("Streaming failed: "+n.status);const r=n.body.getReader(),i=new TextDecoder;let l="";for(;;){const{done:e,value:t}=await r.read();if(e){de.complete("Stream reader reached end");break}if(!o){de.info("warning","Stream stopped by user");break}l+=i.decode(t,{stream:!0});const n=l.split("\n");l=n.pop()||"";for(const e of n)if(e.startsWith("data: "))try{const t=JSON.parse(e.slice(6));await ie(t)}catch(t){console.error("Failed to parse SSE data:",t,e)}}}catch(e){"AbortError"===e.name?(de.info("stream","Stream aborted by user"),c(xe,d+="\n❌ Streaming stopped by user\n",d)):(de.error("Streaming failed",e),c(xe,d+=`\n❌ Streaming failed: ${e.message}\n`,d))}finally{le()}}("/stream",e,t)}()},100)},function(){i?oe():o&&le()},O,G,q,l,v,S,()=>Y("file"),()=>Y("url"),function(e){F[e?"unshift":"push"](()=>{M=e,n(9,M)})},e=>"Enter"===e.key&&Q(),function(e){F[e?"unshift":"push"](()=>{z=e,n(10,z)})},function(){D=this.value,n(1,D)},function(){U=$(this),n(8,U),n(14,B)},()=>c($e,E=!1,E),()=>c($e,E=!0,E),function(){R=$(this),n(6,R)},function(){I=$(this),n(5,I)},function(){P=$(this),n(7,P)},function(){V=this.checked,n(12,V)},function(){V=this.checked,n(12,V)}]}class ft extends re{constructor(e){super(),ne(this,e,pt,mt,i,{},null,[-1,-1,-1])}}function gt(e,t,n){const r=e.slice();return r[28]=t[n],r[30]=n,r}function bt(e,t,n){const r=e.slice();return r[31]=t[n],r}function ht(e,t,n){const r=e.slice();return r[28]=t[n],r[30]=n,r}function xt(e){let t,n,r,o,i,l,s,a,c,p,h,x,k=(e[6]||e[4]?e[10]:e[11])+"";function w(e,t){return e[6]?yt:e[7]?vt:_t}let S=w(e),$=S(e);function j(e,t){return e[7]||e[6]?wt:kt}let C=j(e),T=C(e);function L(e,t){return e[6]||e[4]?$t:St}let E=L(e),M=E(e);function z(e,t){return e[6]||e[4]?Ct:jt}let A=z(e),F=A(e);return{c(){t=f("div"),n=f("div"),r=f("iconify-icon"),o=b(),$.c(),i=b(),l=f("div"),s=f("div"),T.c(),a=b(),c=f("span"),p=g(k),h=b(),M.c(),x=b(),F.c(),v(r,"icon","mdi:waveform"),v(r,"class","text-lg"),_(n,"class","font-bold text-center mb-4 border-b border-terminal-border pb-2 flex items-center justify-center gap-2"),_(c,"class","text-terminal-text-dim"),_(s,"class","flex items-center gap-2 mb-2"),_(l,"class","mb-4"),_(t,"class","border-2 border-terminal-border bg-terminal-bg-light p-4 mb-4")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(n,o),$.m(n,null),d(t,i),d(t,l),d(l,s),T.m(s,null),d(s,a),d(s,c),d(c,p),d(l,h),M.m(l,null),d(t,x),F.m(t,null)},p(e,r){S!==(S=w(e))&&($.d(1),$=S(e),$&&($.c(),$.m(n,null))),C===(C=j(e))&&T?T.p(e,r):(T.d(1),T=C(e),T&&(T.c(),T.m(s,a))),3152&r[0]&&k!==(k=(e[6]||e[4]?e[10]:e[11])+"")&&y(p,k),E===(E=L(e))&&M?M.p(e,r):(M.d(1),M=E(e),M&&(M.c(),M.m(l,null))),A===(A=z(e))&&F?F.p(e,r):(F.d(1),F=A(e),F&&(F.c(),F.m(t,null)))},d(e){e&&m(t),$.d(),T.d(),M.d(),F.d()}}}function _t(e){let t;return{c(){t=g("Streaming Results")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function vt(e){let t;return{c(){t=g("Live Streaming Transcription")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function yt(e){let t;return{c(){t=g("Chunked Upload Streaming")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function kt(e){let t,n,r,o,i=e[4]?"Chunked streaming completed":"Streaming completed";return{c(){t=f("span"),n=b(),r=f("span"),o=g(i),_(t,"class","w-2 h-2 bg-status-success rounded-full"),_(r,"class","font-bold text-status-success")},m(e,i){u(e,t,i),u(e,n,i),u(e,r,i),d(r,o)},p(e,t){16&t[0]&&i!==(i=e[4]?"Chunked streaming completed":"Streaming completed")&&y(o,i)},d(e){e&&(m(t),m(n),m(r))}}}function wt(e){let t,n,r,o,i=e[6]?"Chunked streaming in progress...":"Streaming in progress...";return{c(){t=f("span"),n=b(),r=f("span"),o=g(i),_(t,"class","w-2 h-2 bg-status-info rounded-full animate-pulse"),_(r,"class","font-bold text-status-info")},m(e,i){u(e,t,i),u(e,n,i),u(e,r,i),d(r,o)},p(e,t){64&t[0]&&i!==(i=e[6]?"Chunked streaming in progress...":"Streaming in progress...")&&y(o,i)},d(e){e&&(m(t),m(n),m(r))}}}function St(e){let t,n,r,o,i,l,s,a,c,p,h,x,v,k,S,$,j,C,T,L,E,M,z,A=(e[21]||"?")+"",F=(e[22]||"-")+"",O=un(e[8])+"";return{c(){t=f("div"),n=f("div"),r=g(e[19]),o=g("%"),i=b(),l=f("div"),s=f("span"),a=g("Chunks: "),c=g(e[20]),p=g("/"),h=g(A),x=b(),v=f("span"),k=g("Size: "),S=g(F),$=b(),j=f("span"),C=g("Elapsed: "),T=g(O),L=b(),E=f("span"),M=g("Mode: "),z=g(e[23]),_(n,"class","bg-status-info h-full flex items-center justify-center text-terminal-bg text-xs font-bold transition-all duration-300"),w(n,"width",e[19]+"%"),_(t,"class","bg-terminal-bg border border-terminal-border h-5 overflow-hidden"),_(l,"class","text-xs text-terminal-text-dim mt-2 grid grid-cols-2 md:grid-cols-4 gap-2")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(n,o),u(e,i,m),u(e,l,m),d(l,s),d(s,a),d(s,c),d(s,p),d(s,h),d(l,x),d(l,v),d(v,k),d(v,S),d(l,$),d(l,j),d(j,C),d(j,T),d(l,L),d(l,E),d(E,M),d(E,z)},p(e,t){524288&t[0]&&y(r,e[19]),524288&t[0]&&w(n,"width",e[19]+"%"),1048576&t[0]&&y(c,e[20]),2097152&t[0]&&A!==(A=(e[21]||"?")+"")&&y(h,A),4194304&t[0]&&F!==(F=(e[22]||"-")+"")&&y(S,F),256&t[0]&&O!==(O=un(e[8])+"")&&y(T,O),8388608&t[0]&&y(z,e[23])},d(e){e&&(m(t),m(i),m(l))}}}function $t(e){let t,n,r,o,i,l,s,a,c,p,h,x,v,k,S,$,j,C,T,L,E,M,z,A,F,O,D,I,R,P,U,N,B,J,W,H,G,q,V,K,X,Q,Y,Z,ee,te,ne,re,oe=e[12].upload+"",ie=e[12].processing+"",le=e[12].overall+"",se=(e[18]||"-")+"",ae=un(e[8])+"";return{c(){t=f("div"),n=f("div"),r=f("div"),o=g("Upload "),i=g(oe),l=g("%"),s=b(),a=f("div"),c=f("div"),p=g("Processing "),h=g(ie),x=g("%"),v=b(),k=f("div"),S=f("div"),$=g("Overall "),j=g(le),C=g("%"),T=b(),L=f("div"),E=f("span"),M=g("Uploaded: "),z=g(e[13]),A=g("/"),F=g(e[14]),O=b(),D=f("span"),I=g("Completed: "),R=g(e[15]),P=g("/"),U=g(e[14]),N=b(),B=f("span"),J=g("Failed: "),W=g(e[16]),H=b(),G=f("span"),q=g("Success: "),V=g(e[17]),K=g("%"),X=b(),Q=f("span"),Y=g("Size: "),Z=g(se),ee=b(),te=f("span"),ne=g("Elapsed: "),re=g(ae),_(r,"class","bg-blue-500 h-full flex items-center justify-center text-terminal-bg text-xs font-bold transition-all duration-300"),w(r,"width",e[12].upload+"%"),_(n,"class","bg-terminal-bg border border-terminal-border h-4 overflow-hidden"),_(c,"class","bg-yellow-500 h-full flex items-center justify-center text-terminal-bg text-xs font-bold transition-all duration-300"),w(c,"width",e[12].processing+"%"),_(a,"class","bg-terminal-bg border border-terminal-border h-4 overflow-hidden"),_(S,"class","bg-green-500 h-full flex items-center justify-center text-terminal-bg text-xs font-bold transition-all duration-300"),w(S,"width",e[12].overall+"%"),_(k,"class","bg-terminal-bg border border-terminal-border h-5 overflow-hidden"),_(t,"class","space-y-2"),_(L,"class","text-xs text-terminal-text-dim mt-2 grid grid-cols-2 md:grid-cols-6 gap-2")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(r,o),d(r,i),d(r,l),d(t,s),d(t,a),d(a,c),d(c,p),d(c,h),d(c,x),d(t,v),d(t,k),d(k,S),d(S,$),d(S,j),d(S,C),u(e,T,m),u(e,L,m),d(L,E),d(E,M),d(E,z),d(E,A),d(E,F),d(L,O),d(L,D),d(D,I),d(D,R),d(D,P),d(D,U),d(L,N),d(L,B),d(B,J),d(B,W),d(L,H),d(L,G),d(G,q),d(G,V),d(G,K),d(L,X),d(L,Q),d(Q,Y),d(Q,Z),d(L,ee),d(L,te),d(te,ne),d(te,re)},p(e,t){4096&t[0]&&oe!==(oe=e[12].upload+"")&&y(i,oe),4096&t[0]&&w(r,"width",e[12].upload+"%"),4096&t[0]&&ie!==(ie=e[12].processing+"")&&y(h,ie),4096&t[0]&&w(c,"width",e[12].processing+"%"),4096&t[0]&&le!==(le=e[12].overall+"")&&y(j,le),4096&t[0]&&w(S,"width",e[12].overall+"%"),8192&t[0]&&y(z,e[13]),16384&t[0]&&y(F,e[14]),32768&t[0]&&y(R,e[15]),16384&t[0]&&y(U,e[14]),65536&t[0]&&y(W,e[16]),131072&t[0]&&y(V,e[17]),262144&t[0]&&se!==(se=(e[18]||"-")+"")&&y(Z,se),256&t[0]&&ae!==(ae=un(e[8])+"")&&y(re,ae)},d(e){e&&(m(t),m(T),m(L))}}}function jt(e){let t,n,r,o,i,l;function s(e,t){return e[7]?Lt:Tt}let a=s(e),c=a(e);function p(e,t){return e[3]?Mt:Et}let g=p(e),h=g(e);return{c(){t=f("div"),n=f("div"),r=f("iconify-icon"),o=b(),c.c(),i=b(),l=f("div"),h.c(),v(r,"icon","mdi:text-box"),v(r,"class","text-lg"),_(n,"class","p-3 border-b border-terminal-border font-bold text-terminal-accent flex items-center gap-2"),_(l,"id","streaming-transcript"),_(l,"class","p-4 max-h-80 overflow-y-auto font-mono text-sm leading-relaxed"),_(t,"class","border border-terminal-border bg-terminal-bg")},m(e,s){u(e,t,s),d(t,n),d(n,r),d(n,o),c.m(n,null),d(t,i),d(t,l),h.m(l,null)},p(e,t){a!==(a=s(e))&&(c.d(1),c=a(e),c&&(c.c(),c.m(n,null))),g===(g=p(e))&&h?h.p(e,t):(h.d(1),h=g(e),h&&(h.c(),h.m(l,null)))},d(e){e&&m(t),c.d(),h.d()}}}function Ct(e){let t,n,o,i,l,s,a,c,h,k,w,S,$,C,T,L,E,M,z,A,F,O,D,I,R,P,U,N;function B(e,t){return"speed"===e[1]?At:zt}let J=B(e),W=J(e),H=X(e[0]),G=[];for(let t=0;t<H.length;t+=1)G[t]=Ot(ht(e,H,t));let q="speed"===e[1]&&e[9].length>0&&Dt(e);function V(e,t){return"order"===e[1]?Jt:Bt}let K=V(e),Q=K(e);return{c(){t=f("div"),n=f("span"),n.textContent="View Mode:",o=b(),i=f("div"),l=f("button"),l.innerHTML='<iconify-icon icon="mdi:flash"></iconify-icon> First to Complete',s=b(),a=f("button"),a.innerHTML='<iconify-icon icon="mdi:sort-numeric-ascending"></iconify-icon> In Order Only',c=b(),h=f("span"),W.c(),k=b(),w=f("div"),S=f("div"),$=f("div"),C=f("iconify-icon"),T=g(" \n            Chunk Status Grid\n            "),L=f("span"),E=g("("),M=g(e[15]),z=g("/"),A=g(e[14]),F=g(" completed)"),O=b(),D=f("div"),I=f("div");for(let e=0;e<G.length;e+=1)G[e].c();R=b(),q&&q.c(),P=b(),Q.c(),_(n,"class","font-bold text-terminal-accent"),_(l,"type","button"),_(l,"class","border border-terminal-border text-terminal-text px-3 py-1 text-sm hover:bg-yellow-400 transition-colors flex items-center gap-2"),j(l,"bg-yellow-400","speed"===e[1]),j(l,"bg-terminal-bg","speed"!==e[1]),_(a,"type","button"),_(a,"class","border border-terminal-border text-terminal-text px-3 py-1 text-sm hover:bg-yellow-400 transition-colors flex items-center gap-2"),j(a,"bg-yellow-400","order"===e[1]),j(a,"bg-terminal-bg","order"!==e[1]),_(i,"class","flex gap-2"),_(h,"class","text-xs text-terminal-text-dim"),_(t,"class","mb-4 flex items-center gap-4"),v(C,"icon","mdi:view-grid"),v(C,"class","text-lg"),_(L,"class","text-xs text-terminal-text-dim ml-auto"),_($,"class","p-3 border-b border-terminal-border font-bold text-terminal-accent flex items-center gap-2"),_(I,"class","grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2"),_(D,"class","p-4 max-h-80 overflow-y-auto"),_(S,"class","border border-terminal-border bg-terminal-bg"),_(w,"class","space-y-4")},m(r,m){u(r,t,m),d(t,n),d(t,o),d(t,i),d(i,l),d(i,s),d(i,a),d(t,c),d(t,h),W.m(h,null),u(r,k,m),u(r,w,m),d(w,S),d(S,$),d($,C),d($,T),d($,L),d(L,E),d(L,M),d(L,z),d(L,A),d(L,F),d(S,O),d(S,D),d(D,I);for(let e=0;e<G.length;e+=1)G[e]&&G[e].m(I,null);d(w,R),q&&q.m(w,null),d(w,P),Q.m(w,null),U||(N=[x(l,"click",e[26]),x(a,"click",e[27])],U=!0)},p(e,t){if(2&t[0]&&j(l,"bg-yellow-400","speed"===e[1]),2&t[0]&&j(l,"bg-terminal-bg","speed"!==e[1]),2&t[0]&&j(a,"bg-yellow-400","order"===e[1]),2&t[0]&&j(a,"bg-terminal-bg","order"!==e[1]),J!==(J=B(e))&&(W.d(1),W=J(e),W&&(W.c(),W.m(h,null))),32768&t[0]&&y(M,e[15]),16384&t[0]&&y(A,e[14]),1&t[0]){let n;for(H=X(e[0]),n=0;n<H.length;n+=1){const r=ht(e,H,n);G[n]?G[n].p(r,t):(G[n]=Ot(r),G[n].c(),G[n].m(I,null))}for(;n<G.length;n+=1)G[n].d(1);G.length=H.length}"speed"===e[1]&&e[9].length>0?q?q.p(e,t):(q=Dt(e),q.c(),q.m(w,P)):q&&(q.d(1),q=null),K===(K=V(e))&&Q?Q.p(e,t):(Q.d(1),Q=K(e),Q&&(Q.c(),Q.m(w,null)))},d(e){e&&(m(t),m(k),m(w)),W.d(),p(G,e),q&&q.d(),Q.d(),U=!1,r(N)}}}function Tt(e){let t;return{c(){t=g("Final Transcript:")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Lt(e){let t;return{c(){t=g("Live Transcript:")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Et(t){let n;return{c(){n=f("div"),n.textContent="Waiting for transcription results...",_(n,"class","text-terminal-text-dim italic")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Mt(e){let t,n;return{c(){t=f("pre"),n=g(e[3]),_(t,"class","whitespace-pre-wrap")},m(e,r){u(e,t,r),d(t,n)},p(e,t){8&t[0]&&y(n,e[3])},d(e){e&&m(t)}}}function zt(e){let t;return{c(){t=g("Shows only contiguous chunks in order (readable flow)")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function At(e){let t;return{c(){t=g("Shows chunks as they complete (fastest feedback)")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Ft(e){let t,n,r,o=e[28].processingTime+"";return{c(){t=f("div"),n=g(o),r=g("ms"),_(t,"class","text-xs opacity-70")},m(e,o){u(e,t,o),d(t,n),d(t,r)},p(e,t){1&t[0]&&o!==(o=e[28].processingTime+"")&&y(n,o)},d(e){e&&m(t)}}}function Ot(e){let t,n,r,o,i,l,s,a,c,p,g=e[28].processingTime&&Ft(e);return{c(){t=f("div"),n=f("div"),r=f("iconify-icon"),i=b(),l=f("div"),l.textContent=`${e[30]}`,s=b(),g&&g.c(),a=b(),v(r,"icon",o=dn(e[28].status)),v(r,"class","text-sm"),_(l,"class","font-bold"),_(n,"class","flex flex-col items-center gap-1"),_(t,"class",c="border-2 p-2 text-center text-xs transition-all duration-300 "+cn(e[28].status)),_(t,"title",p="Chunk "+e[30]+": "+e[28].status+(e[28].processingTime?` (${e[28].processingTime}ms)`:"")+(e[28].skipReason?` - ${e[28].skipReason}`:""))},m(e,o){u(e,t,o),d(t,n),d(n,r),d(n,i),d(n,l),d(n,s),g&&g.m(n,null),d(t,a)},p(e,i){1&i[0]&&o!==(o=dn(e[28].status))&&v(r,"icon",o),e[28].processingTime?g?g.p(e,i):(g=Ft(e),g.c(),g.m(n,null)):g&&(g.d(1),g=null),1&i[0]&&c!==(c="border-2 p-2 text-center text-xs transition-all duration-300 "+cn(e[28].status))&&_(t,"class",c),1&i[0]&&p!==(p="Chunk "+e[30]+": "+e[28].status+(e[28].processingTime?` (${e[28].processingTime}ms)`:"")+(e[28].skipReason?` - ${e[28].skipReason}`:""))&&_(t,"title",p)},d(e){e&&m(t),g&&g.d()}}}function Dt(e){let t,n,r,o,i,l,s,a,c,h,x=e[9].length+"",k=X(e[9]),w=[];for(let t=0;t<k.length;t+=1)w[t]=Nt(bt(e,k,t));return{c(){t=f("div"),n=f("div"),r=f("iconify-icon"),o=g(" \n              First to Complete\n              "),i=f("span"),l=g("Arrival order • "),s=g(x),a=g(" chunks ready"),c=b(),h=f("div");for(let e=0;e<w.length;e+=1)w[e].c();v(r,"icon","mdi:flash"),v(r,"class","text-lg"),_(i,"class","text-xs text-terminal-text-dim ml-auto"),_(n,"class","p-3 border-b border-terminal-border font-bold text-terminal-accent flex items-center gap-2"),_(h,"class","p-4 max-h-80 overflow-y-auto space-y-3"),_(t,"class","border border-terminal-border bg-terminal-bg")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(n,o),d(n,i),d(i,l),d(i,s),d(i,a),d(t,c),d(t,h);for(let e=0;e<w.length;e+=1)w[e]&&w[e].m(h,null)},p(e,t){if(512&t[0]&&x!==(x=e[9].length+"")&&y(s,x),512&t[0]){let n;for(k=X(e[9]),n=0;n<k.length;n+=1){const r=bt(e,k,n);w[n]?w[n].p(r,t):(w[n]=Nt(r),w[n].c(),w[n].m(h,null))}for(;n<w.length;n+=1)w[n].d(1);w.length=k.length}},d(e){e&&m(t),p(w,e)}}}function It(e){let t,n,r,o,i=e[31].processingTime+"";return{c(){t=f("span"),n=g("("),r=g(i),o=g("ms)"),_(t,"class","text-xs text-terminal-text-dim")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){512&t[0]&&i!==(i=e[31].processingTime+"")&&y(r,i)},d(e){e&&m(t)}}}function Rt(e){let t,n,r=mn(e[31].completedAt)+"";return{c(){t=f("span"),n=g(r),_(t,"class","text-xs text-blue-400 font-mono")},m(e,r){u(e,t,r),d(t,n)},p(e,t){512&t[0]&&r!==(r=mn(e[31].completedAt)+"")&&y(n,r)},d(e){e&&m(t)}}}function Pt(e){let t;return{c(){t=f("span"),t.textContent="LLM",_(t,"class","text-xs bg-purple-600 text-white px-2 py-1 rounded")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Ut(e){let t,n,r,o,i,l,s,a=e[31].rawText+"";return{c(){t=f("div"),n=f("div"),n.textContent="Raw transcript:",r=b(),o=f("div"),i=g('"'),l=g(a),s=g('"'),_(n,"class","text-xs text-terminal-text-dim mb-1"),_(o,"class","text-sm font-mono whitespace-pre-wrap text-terminal-text-dim"),_(t,"class","mt-2 pt-2 border-t border-terminal-border")},m(e,a){u(e,t,a),d(t,n),d(t,r),d(t,o),d(o,i),d(o,l),d(o,s)},p(e,t){512&t[0]&&a!==(a=e[31].rawText+"")&&y(l,a)},d(e){e&&m(t)}}}function Nt(e){let t,n,r,o,i,l,s,a,c,p,h,x,v,k,w,S,$,j,C,T,L,E,M,z,A,F,O,D=e[31].chunkIndex+"",I=pn(e[31].text,80)+"",R=e[31].text+"",P=e[31].processingTime&&It(e),U=e[31].completedAt&&Rt(e),N=e[31].llmApplied&&Pt(),B=e[31].rawText&&e[31].text!==e[31].rawText&&Ut(e);return{c(){t=f("div"),n=f("div"),r=f("div"),o=f("span"),i=g("Chunk "),l=g(D),s=b(),P&&P.c(),a=b(),U&&U.c(),c=b(),N&&N.c(),p=b(),h=f("details"),x=f("summary"),v=f("div"),k=f("span"),k.textContent="▶",w=b(),S=f("span"),$=g('"'),j=g(I),C=g('"'),T=b(),L=f("div"),E=f("div"),M=g('"'),z=g(R),A=g('"'),F=b(),B&&B.c(),O=b(),_(o,"class","font-bold text-green-800"),_(r,"class","flex items-center gap-2 mb-2"),_(k,"class","text-xs text-terminal-text-dim group-open:rotate-90 transition-transform"),_(S,"class","italic"),_(v,"class","flex items-center gap-2"),_(x,"class","cursor-pointer text-sm font-mono text-terminal-text hover:text-terminal-accent transition-colors list-none"),_(E,"class","text-sm font-mono whitespace-pre-wrap text-terminal-text"),_(L,"class","mt-3 pl-4 border-l-2 border-green-800/30"),_(h,"class","group"),_(n,"class","p-3"),_(t,"class","border border-green-800 bg-green-900/10 rounded")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(r,o),d(o,i),d(o,l),d(r,s),P&&P.m(r,null),d(r,a),U&&U.m(r,null),d(r,c),N&&N.m(r,null),d(n,p),d(n,h),d(h,x),d(x,v),d(v,k),d(v,w),d(v,S),d(S,$),d(S,j),d(S,C),d(h,T),d(h,L),d(L,E),d(E,M),d(E,z),d(E,A),d(L,F),B&&B.m(L,null),d(t,O)},p(e,t){512&t[0]&&D!==(D=e[31].chunkIndex+"")&&y(l,D),e[31].processingTime?P?P.p(e,t):(P=It(e),P.c(),P.m(r,a)):P&&(P.d(1),P=null),e[31].completedAt?U?U.p(e,t):(U=Rt(e),U.c(),U.m(r,c)):U&&(U.d(1),U=null),e[31].llmApplied?N||(N=Pt(),N.c(),N.m(r,null)):N&&(N.d(1),N=null),512&t[0]&&I!==(I=pn(e[31].text,80)+"")&&y(j,I),512&t[0]&&R!==(R=e[31].text+"")&&y(z,R),e[31].rawText&&e[31].text!==e[31].rawText?B?B.p(e,t):(B=Ut(e),B.c(),B.m(L,null)):B&&(B.d(1),B=null)},d(e){e&&m(t),P&&P.d(),U&&U.d(),N&&N.d(),B&&B.d()}}}function Bt(e){let t,n,r,o;function i(e,t){return e[2]?Ht:Wt}let l=i(e),s=l(e);return{c(){t=f("div"),n=f("div"),n.innerHTML='<iconify-icon icon="mdi:text-box" class="text-lg"></iconify-icon> \n              Readable Transcript (Ordered)',r=b(),o=f("div"),s.c(),_(n,"class","p-3 border-b border-terminal-border font-bold text-terminal-accent flex items-center gap-2"),_(o,"id","chunked-readable-transcript"),_(o,"class","p-4 max-h-80 overflow-y-auto font-mono text-sm leading-relaxed"),_(t,"class","border border-terminal-border bg-terminal-bg")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o),s.m(o,null)},p(e,t){l===(l=i(e))&&s?s.p(e,t):(s.d(1),s=l(e),s&&(s.c(),s.m(o,null)))},d(e){e&&m(t),s.d()}}}function Jt(e){let t,n,r,o,i,l,s,a,c,h,x,k,w=e[0].filter(fn).length+"",S=X(e[0]),$=[];for(let t=0;t<S.length;t+=1)$[t]=sn(gt(e,S,t));return{c(){t=f("div"),n=f("div"),r=f("iconify-icon"),o=g(" \n              In Order (Sequential)\n              "),i=f("span"),l=g("Ordered chunks • "),s=g(w),a=g("/"),c=g(e[14]),h=g(" completed"),x=b(),k=f("div");for(let e=0;e<$.length;e+=1)$[e].c();v(r,"icon","mdi:sort-numeric-ascending"),v(r,"class","text-lg"),_(i,"class","text-xs text-terminal-text-dim ml-auto"),_(n,"class","p-3 border-b border-terminal-border font-bold text-terminal-accent flex items-center gap-2"),_(k,"class","p-4 max-h-80 overflow-y-auto space-y-3"),_(t,"class","border border-terminal-border bg-terminal-bg")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(n,o),d(n,i),d(i,l),d(i,s),d(i,a),d(i,c),d(i,h),d(t,x),d(t,k);for(let e=0;e<$.length;e+=1)$[e]&&$[e].m(k,null)},p(e,t){if(1&t[0]&&w!==(w=e[0].filter(fn).length+"")&&y(s,w),16384&t[0]&&y(c,e[14]),1&t[0]){let n;for(S=X(e[0]),n=0;n<S.length;n+=1){const r=gt(e,S,n);$[n]?$[n].p(r,t):($[n]=sn(r),$[n].c(),$[n].m(k,null))}for(;n<$.length;n+=1)$[n].d(1);$.length=S.length}},d(e){e&&m(t),p($,e)}}}function Wt(t){let n;return{c(){n=f("div"),n.textContent="Waiting for chunks to complete in order...",_(n,"class","text-terminal-text-dim italic")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Ht(e){let t,n;return{c(){t=f("pre"),n=g(e[2]),_(t,"class","whitespace-pre-wrap")},m(e,r){u(e,t,r),d(t,n)},p(e,t){4&t[0]&&y(n,e[2])},d(e){e&&m(t)}}}function Gt(e){let t,n,r,o,i,l,s,a,c;function p(e,t){return e[28]&&"uploading"===e[28].status?Qt:e[28]&&"processing"===e[28].status?Xt:e[28]&&"failed"===e[28].status?Kt:Vt}let g=p(e),h=g(e);function x(e,t){return e[28]&&"failed"===e[28].status&&e[28].error?tn:e[28]&&"uploading"===e[28].status?en:e[28]&&"processing"===e[28].status?Zt:Yt}let v=x(e),y=v(e);return{c(){t=f("div"),n=f("div"),r=f("div"),o=f("span"),o.textContent=`Chunk ${e[30]}`,i=b(),l=f("span"),h.c(),s=b(),a=f("div"),y.c(),c=b(),_(o,"class","font-bold text-gray-400"),_(l,"class","text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded"),_(r,"class","flex items-center gap-2 mb-2"),_(a,"class","text-sm text-gray-500 italic"),_(n,"class","p-3"),_(t,"class","border border-gray-600 bg-gray-800/20 rounded")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(r,o),d(r,i),d(r,l),h.m(l,null),d(n,s),d(n,a),y.m(a,null),d(t,c)},p(e,t){g!==(g=p(e))&&(h.d(1),h=g(e),h&&(h.c(),h.m(l,null))),v===(v=x(e))&&y?y.p(e,t):(y.d(1),y=v(e),y&&(y.c(),y.m(a,null)))},d(e){e&&m(t),h.d(),y.d()}}}function qt(e){let t,n,r,o,i,l,s,a,c,p,h,x,v,k,w,S,$,j,C,T,L,E,M,z,A,F=pn(e[28].text,80)+"",O=e[28].text+"",D=e[28].processingTime&&nn(e),I=e[28].completedAt&&rn(e),R=e[28].llmApplied&&on(),P=e[28].rawText&&e[28].text!==e[28].rawText&&ln(e);return{c(){t=f("div"),n=f("div"),r=f("div"),o=f("span"),o.textContent=`Chunk ${e[30]}`,i=b(),D&&D.c(),l=b(),I&&I.c(),s=b(),R&&R.c(),a=b(),c=f("details"),p=f("summary"),h=f("div"),x=f("span"),x.textContent="▶",v=b(),k=f("span"),w=g('"'),S=g(F),$=g('"'),j=b(),C=f("div"),T=f("div"),L=g('"'),E=g(O),M=g('"'),z=b(),P&&P.c(),A=b(),_(o,"class","font-bold text-green-800"),_(r,"class","flex items-center gap-2 mb-2"),_(x,"class","text-xs text-terminal-text-dim group-open:rotate-90 transition-transform"),_(k,"class","italic"),_(h,"class","flex items-center gap-2"),_(p,"class","cursor-pointer text-sm font-mono text-terminal-text hover:text-terminal-accent transition-colors list-none"),_(T,"class","text-sm font-mono whitespace-pre-wrap text-terminal-text"),_(C,"class","mt-3 pl-4 border-l-2 border-green-800/30"),_(c,"class","group"),_(n,"class","p-3"),_(t,"class","border border-green-800 bg-green-900/10 rounded")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(r,o),d(r,i),D&&D.m(r,null),d(r,l),I&&I.m(r,null),d(r,s),R&&R.m(r,null),d(n,a),d(n,c),d(c,p),d(p,h),d(h,x),d(h,v),d(h,k),d(k,w),d(k,S),d(k,$),d(c,j),d(c,C),d(C,T),d(T,L),d(T,E),d(T,M),d(C,z),P&&P.m(C,null),d(t,A)},p(e,t){e[28].processingTime?D?D.p(e,t):(D=nn(e),D.c(),D.m(r,l)):D&&(D.d(1),D=null),e[28].completedAt?I?I.p(e,t):(I=rn(e),I.c(),I.m(r,s)):I&&(I.d(1),I=null),e[28].llmApplied?R||(R=on(),R.c(),R.m(r,null)):R&&(R.d(1),R=null),1&t[0]&&F!==(F=pn(e[28].text,80)+"")&&y(S,F),1&t[0]&&O!==(O=e[28].text+"")&&y(E,O),e[28].rawText&&e[28].text!==e[28].rawText?P?P.p(e,t):(P=ln(e),P.c(),P.m(C,null)):P&&(P.d(1),P=null)},d(e){e&&m(t),D&&D.d(),I&&I.d(),R&&R.d(),P&&P.d()}}}function Vt(e){let t;return{c(){t=g("Waiting")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Kt(e){let t;return{c(){t=g("Failed")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Xt(e){let t;return{c(){t=g("Processing...")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Qt(e){let t;return{c(){t=g("Uploading...")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Yt(t){let n;return{c(){n=g("Waiting for previous chunks to complete")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Zt(t){let n;return{c(){n=g("Transcription in progress...")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function en(t){let n;return{c(){n=g("Upload in progress...")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function tn(e){let t,n,r=e[28].error+"";return{c(){t=g("Error: "),n=g(r)},m(e,r){u(e,t,r),u(e,n,r)},p(e,t){1&t[0]&&r!==(r=e[28].error+"")&&y(n,r)},d(e){e&&(m(t),m(n))}}}function nn(e){let t,n,r,o,i=e[28].processingTime+"";return{c(){t=f("span"),n=g("("),r=g(i),o=g("ms)"),_(t,"class","text-xs text-terminal-text-dim")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){1&t[0]&&i!==(i=e[28].processingTime+"")&&y(r,i)},d(e){e&&m(t)}}}function rn(e){let t,n,r=mn(e[28].completedAt)+"";return{c(){t=f("span"),n=g(r),_(t,"class","text-xs text-blue-400 font-mono")},m(e,r){u(e,t,r),d(t,n)},p(e,t){1&t[0]&&r!==(r=mn(e[28].completedAt)+"")&&y(n,r)},d(e){e&&m(t)}}}function on(e){let t;return{c(){t=f("span"),t.textContent="LLM",_(t,"class","text-xs bg-purple-600 text-white px-2 py-1 rounded")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function ln(e){let t,n,r,o,i,l,s,a=e[28].rawText+"";return{c(){t=f("div"),n=f("div"),n.textContent="Raw transcript:",r=b(),o=f("div"),i=g('"'),l=g(a),s=g('"'),_(n,"class","text-xs text-terminal-text-dim mb-1"),_(o,"class","text-sm font-mono whitespace-pre-wrap text-terminal-text-dim"),_(t,"class","mt-2 pt-2 border-t border-terminal-border")},m(e,a){u(e,t,a),d(t,n),d(t,r),d(t,o),d(o,i),d(o,l),d(o,s)},p(e,t){1&t[0]&&a!==(a=e[28].rawText+"")&&y(l,a)},d(e){e&&m(t)}}}function sn(e){let t;function n(e,t){return e[28]&&"complete"===e[28].status?qt:Gt}let r=n(e),o=r(e);return{c(){o.c(),t=h()},m(e,n){o.m(e,n),u(e,t,n)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){e&&m(t),o.d(e)}}}function an(t){let n,r=(t[7]||t[5]||t[6]||t[4])&&xt(t);return{c(){r&&r.c(),n=h()},m(e,t){r&&r.m(e,t),u(e,n,t)},p(e,t){e[7]||e[5]||e[6]||e[4]?r?r.p(e,t):(r=xt(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&m(n),r&&r.d(e)}}}function cn(e){switch(e){case"pending":default:return"border-terminal-border bg-terminal-bg";case"uploading":return"border-blue-400 bg-blue-900/20 animate-pulse";case"processing":return"border-yellow-400 bg-yellow-900/20 animate-pulse";case"complete":return"border-green-400 bg-green-900/20";case"failed":return"border-red-400 bg-red-900/20";case"skipped":return"border-gray-400 bg-gray-900/20"}}function dn(e){switch(e){case"pending":default:return"mdi:circle-outline";case"uploading":return"mdi:upload";case"processing":return"mdi:cog";case"complete":return"mdi:check-circle";case"failed":return"mdi:alert-circle";case"skipped":return"mdi:skip-forward"}}function un(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}function mn(e){if(!e)return"";const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}.${t.getMilliseconds().toString().padStart(3,"0")}`}function pn(e,t=100){if(!e)return"";const n=e.match(/^[^.!?]*[.!?]/);if(n&&n[0].length<=t)return n[0].trim();if(e.length<=t)return e;const r=e.substring(0,t),o=r.lastIndexOf(" ");return o>.7*t?r.substring(0,o)+"...":r+"..."}const fn=e=>e&&"complete"===e.status;function gn(e,t,n){let r,o,i,l,s,d,u,m,p,f,g,b,h,x,_,v,y,k,w,S,$,j,C;a(e,je,e=>n(0,r=e)),a(e,Ce,e=>n(1,o=e)),a(e,Le,e=>n(2,i=e)),a(e,xe,e=>n(3,l=e)),a(e,be,e=>n(25,s=e)),a(e,Se,e=>n(4,d=e)),a(e,fe,e=>n(5,u=e)),a(e,we,e=>n(6,m=e)),a(e,pe,e=>n(7,p=e)),a(e,Ee,e=>n(10,f=e)),a(e,ge,e=>n(11,g=e)),a(e,Te,e=>n(12,b=e)),a(e,ze,e=>n(13,h=e)),a(e,Me,e=>n(14,x=e)),a(e,Ae,e=>n(15,_=e)),a(e,Fe,e=>n(16,v=e)),a(e,Oe,e=>n(17,y=e)),a(e,De,e=>n(18,k=e)),a(e,he,e=>n(19,w=e)),a(e,_e,e=>n(20,S=e)),a(e,ve,e=>n(21,$=e)),a(e,ye,e=>n(22,j=e)),a(e,ke,e=>n(23,C=e));let T=0,L=null,E=[];return e.$$.update=()=>{50331888&e.$$.dirty[0]&&(!p&&!m||L?p||m||!L||(clearInterval(L),n(24,L=null),(u||d)&&n(8,T=Math.floor((Date.now()-s)/1e3))):n(24,L=setInterval(()=>{n(8,T=Math.floor((Date.now()-s)/1e3))},1e3))),8&e.$$.dirty[0]&&l&&setTimeout(()=>{const e=document.getElementById("streaming-transcript");e&&(e.scrollTop=e.scrollHeight)},50),4&e.$$.dirty[0]&&i&&setTimeout(()=>{const e=document.getElementById("chunked-readable-transcript");e&&(e.scrollTop=e.scrollHeight)},50),3&e.$$.dirty[0]&&n(9,E="speed"===o?r.filter(e=>e&&"complete"===e.status).sort((e,t)=>(e.arrivalOrder||0)-(t.arrivalOrder||0)):r.filter(e=>e&&"complete"===e.status).slice(0,function(e){for(let t=0;t<e.length;t++)if(!e[t]||"complete"!==e[t].status)return t-1;return e.length-1}(r)+1))},[r,o,i,l,d,u,m,p,T,E,f,g,b,h,x,_,v,y,k,w,S,$,j,C,L,s,()=>c(Ce,o="speed",o),()=>c(Ce,o="order",o)]}class bn extends re{constructor(e){super(),ne(this,e,gn,an,i,{},null,[-1,-1])}}function hn(t){let n,r,o,i,l,s,a,c;return o=new Ze({}),l=new ft({}),a=new bn({}),{c(){n=f("div"),r=f("div"),Y(o.$$.fragment),i=b(),Y(l.$$.fragment),s=b(),Y(a.$$.fragment),_(r,"class","grid grid-cols-1 lg:grid-cols-2 gap-4"),_(n,"class","border-2 border-terminal-border bg-terminal-bg-light p-4 mb-4")},m(e,t){u(e,n,t),d(n,r),Z(o,r,null),d(r,i),Z(l,r,null),u(e,s,t),Z(a,e,t),c=!0},p:e,i(e){c||(V(o.$$.fragment,e),V(l.$$.fragment,e),V(a.$$.fragment,e),c=!0)},o(e){K(o.$$.fragment,e),K(l.$$.fragment,e),K(a.$$.fragment,e),c=!1},d(e){e&&(m(n),m(s)),ee(o),ee(l),ee(a,e)}}}function xn(e){return z(),[]}class _n extends re{constructor(e){super(),ne(this,e,xn,hn,i,{})}}function vn(e,t,n){const r=e.slice();return r[21]=t[n],r}function yn(e){let t;return{c(){t=f("span"),t.textContent="URL",_(t,"class","text-status-info text-xs bg-blue-900/30 px-1 rounded")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function kn(e){let t;return{c(){t=f("span"),t.textContent="Streamed",_(t,"class","text-status-info text-xs bg-blue-900/30 px-1 rounded")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function wn(e){let t,n,r,o,i,l=e[0].total_segments+"";return{c(){t=f("span"),n=f("iconify-icon"),r=b(),o=g(l),i=g(" segments"),v(n,"icon","mdi:format-list-numbered"),v(n,"class","text-xs")},m(e,l){u(e,t,l),d(t,n),d(t,r),d(t,o),d(t,i)},p(e,t){1&t&&l!==(l=e[0].total_segments+"")&&y(o,l)},d(e){e&&m(t)}}}function Sn(e){let t,n,r,o,i=(e[0].progress||0)+"";return{c(){t=f("div"),n=f("div"),r=g(i),o=g("%"),_(n,"class","bg-terminal-accent h-full flex items-center justify-center text-terminal-bg text-xs font-bold transition-all duration-300"),w(n,"width",(e[0].progress||0)+"%"),_(t,"class","bg-terminal-bg border border-terminal-border h-5 overflow-hidden mt-2")},m(e,i){u(e,t,i),d(t,n),d(n,r),d(n,o)},p(e,t){1&t&&i!==(i=(e[0].progress||0)+"")&&y(r,i),1&t&&w(n,"width",(e[0].progress||0)+"%")},d(e){e&&m(t)}}}function $n(e){let t;return{c(){t=f("span"),t.innerHTML='<iconify-icon icon="mdi:brain" class="text-xs"></iconify-icon> LLM Enhanced',_(t,"class","text-terminal-accent")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function jn(e){let t,n,r,o,i=e[0].error+"";return{c(){t=f("span"),n=f("iconify-icon"),r=g(" \n          Error: "),o=g(i),v(n,"icon","mdi:alert-circle"),v(n,"class","text-xs"),_(t,"class","text-status-error")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){1&t&&i!==(i=e[0].error+"")&&y(o,i)},d(e){e&&m(t)}}}function Cn(e){let t;function n(e,t){return"done"===e[0].status?Ln:Tn}let r=n(e),o=r(e);return{c(){t=f("div"),o.c(),_(t,"class","border-t border-terminal-border bg-gray-900/5 p-3")},m(e,n){u(e,t,n),o.m(t,null)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t,null)))},d(e){e&&m(t),o.d()}}}function Tn(e){let t,n,r,o,i,l,s,a,c,p,h,x,v,k,w,S,$,j,C,T,L,E,M,z,A,F,O,D,I,R,P,U,N,B,J=e[0].job_id+"",W=e[0].status+"",H=(e[0].upload_method||"direct")+"",G=(e[0].processing_method||"direct")+"",q=(e[0].use_llm?e[0].llm_mode||"enabled":"disabled")+"",V=Re(e[0].file_size||0)+"",K=e[0].model&&En(e),X=e[0].chunk_size_mb&&Mn(e);return{c(){t=f("div"),n=f("div"),r=f("div"),r.textContent="Job Details",o=b(),i=f("div"),l=f("div"),s=g("ID: "),a=g(J),c=b(),p=f("div"),h=g("Status: "),x=g(W),v=b(),k=f("div"),w=g("Upload: "),S=g(H),$=b(),j=f("div"),C=g("Processing: "),T=g(G),L=b(),K&&K.c(),E=b(),M=f("div"),z=f("div"),z.textContent="Settings",A=b(),F=f("div"),O=f("div"),D=g("LLM: "),I=g(q),R=b(),X&&X.c(),P=b(),U=f("div"),N=g("File Size: "),B=g(V),_(r,"class","text-terminal-accent font-bold mb-2"),_(i,"class","space-y-1 text-xs text-terminal-text-dim"),_(z,"class","text-terminal-accent font-bold mb-2"),_(F,"class","space-y-1 text-xs text-terminal-text-dim"),_(t,"class","grid grid-cols-1 md:grid-cols-2 gap-4")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(n,o),d(n,i),d(i,l),d(l,s),d(l,a),d(i,c),d(i,p),d(p,h),d(p,x),d(i,v),d(i,k),d(k,w),d(k,S),d(i,$),d(i,j),d(j,C),d(j,T),d(i,L),K&&K.m(i,null),d(t,E),d(t,M),d(M,z),d(M,A),d(M,F),d(F,O),d(O,D),d(O,I),d(F,R),X&&X.m(F,null),d(F,P),d(F,U),d(U,N),d(U,B)},p(e,t){1&t&&J!==(J=e[0].job_id+"")&&y(a,J),1&t&&W!==(W=e[0].status+"")&&y(x,W),1&t&&H!==(H=(e[0].upload_method||"direct")+"")&&y(S,H),1&t&&G!==(G=(e[0].processing_method||"direct")+"")&&y(T,G),e[0].model?K?K.p(e,t):(K=En(e),K.c(),K.m(i,null)):K&&(K.d(1),K=null),1&t&&q!==(q=(e[0].use_llm?e[0].llm_mode||"enabled":"disabled")+"")&&y(I,q),e[0].chunk_size_mb?X?X.p(e,t):(X=Mn(e),X.c(),X.m(F,P)):X&&(X.d(1),X=null),1&t&&V!==(V=Re(e[0].file_size||0)+"")&&y(B,V)},d(e){e&&m(t),K&&K.d(),X&&X.d()}}}function Ln(e){let t,n,o,i,l,s,a,c,p,h,k,w,S,$,j,C,T,L,E,M,z,A,F,O,D,I,R,P,U,N,B,J,W,H,G,q,V,K,X,Q,Y=e[0].job_id+"",Z=e[0].status+"",ee=(e[0].processing_method||"direct")+"",te=e[4]?"Copied!":"Copy Transcript",ne=e[0].total_segments>0&&zn(e),re=e[0].debug_save_chunks&&An(e);function oe(e,t){return"streaming"===e[0].processing_method?Bn:Nn}let ie=oe(e),le=ie(e);function se(e,t){return"streaming"===e[0].processing_method?Wn:Jn}let ae=se(e),ce=ae(e);return{c(){t=f("div"),n=f("div"),o=f("div"),o.textContent="Job Details",i=b(),l=f("div"),s=f("div"),a=g("ID: "),c=g(Y),p=b(),h=f("div"),k=g("Status: "),w=g(Z),S=b(),$=f("div"),j=g("Method: "),C=g(ee),T=b(),ne&&ne.c(),L=b(),E=f("div"),E.textContent="Actions",M=b(),z=f("div"),A=f("button"),F=f("iconify-icon"),O=b(),D=g(te),I=b(),R=f("button"),R.innerHTML='<iconify-icon icon="mdi:code-json" class="text-xs"></iconify-icon> Copy JSON',P=b(),re&&re.c(),U=b(),N=f("div"),B=f("div"),B.textContent="Full Transcript",J=b(),W=f("div"),H=f("div"),G=f("iconify-icon"),q=b(),le.c(),V=b(),K=f("div"),ce.c(),_(o,"class","text-terminal-accent font-bold mb-2"),_(l,"class","space-y-1 text-xs text-terminal-text-dim mb-4"),_(E,"class","text-terminal-accent font-bold mb-2"),v(F,"icon","mdi:content-copy"),v(F,"class","text-xs"),A.disabled=e[4],_(A,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-2 py-1 text-xs hover:bg-gray-700 transition-colors flex items-center gap-1 w-full"),_(R,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-2 py-1 text-xs hover:bg-gray-700 transition-colors flex items-center gap-1 w-full"),_(z,"class","space-y-2"),_(n,"class","lg:col-span-1 flex flex-col"),_(B,"class","text-terminal-accent font-bold mb-2"),v(G,"icon","mdi:text-box"),v(G,"class","text-sm"),_(H,"class","p-3 border-b border-terminal-border font-bold text-terminal-text-dim text-xs flex-shrink-0"),_(K,"class","p-4 flex-1 overflow-y-auto font-mono text-sm leading-relaxed min-h-[16rem]"),_(W,"class","border border-terminal-border bg-terminal-bg flex flex-col flex-1 min-h-0"),_(N,"class","lg:col-span-2 flex flex-col"),_(t,"class","grid grid-cols-1 lg:grid-cols-3 gap-4 lg:items-start")},m(r,m){u(r,t,m),d(t,n),d(n,o),d(n,i),d(n,l),d(l,s),d(s,a),d(s,c),d(l,p),d(l,h),d(h,k),d(h,w),d(l,S),d(l,$),d($,j),d($,C),d(l,T),ne&&ne.m(l,null),d(n,L),d(n,E),d(n,M),d(n,z),d(z,A),d(A,F),d(A,O),d(A,D),d(z,I),d(z,R),d(z,P),re&&re.m(z,null),d(t,U),d(t,N),d(N,B),d(N,J),d(N,W),d(W,H),d(H,G),d(H,q),le.m(H,null),d(W,V),d(W,K),ce.m(K,null),X||(Q=[x(A,"click",e[12]),x(R,"click",e[13])],X=!0)},p(e,t){1&t&&Y!==(Y=e[0].job_id+"")&&y(c,Y),1&t&&Z!==(Z=e[0].status+"")&&y(w,Z),1&t&&ee!==(ee=(e[0].processing_method||"direct")+"")&&y(C,ee),e[0].total_segments>0?ne?ne.p(e,t):(ne=zn(e),ne.c(),ne.m(l,null)):ne&&(ne.d(1),ne=null),16&t&&te!==(te=e[4]?"Copied!":"Copy Transcript")&&y(D,te),16&t&&(A.disabled=e[4]),e[0].debug_save_chunks?re?re.p(e,t):(re=An(e),re.c(),re.m(z,null)):re&&(re.d(1),re=null),ie!==(ie=oe(e))&&(le.d(1),le=ie(e),le&&(le.c(),le.m(H,null))),ae===(ae=se(e))&&ce?ce.p(e,t):(ce.d(1),ce=ae(e),ce&&(ce.c(),ce.m(K,null)))},d(e){e&&m(t),ne&&ne.d(),re&&re.d(),le.d(),ce.d(),X=!1,r(Q)}}}function En(e){let t,n,r,o=e[0].model+"";return{c(){t=f("div"),n=g("Model: "),r=g(o)},m(e,o){u(e,t,o),d(t,n),d(t,r)},p(e,t){1&t&&o!==(o=e[0].model+"")&&y(r,o)},d(e){e&&m(t)}}}function Mn(e){let t,n,r,o,i=e[0].chunk_size_mb+"";return{c(){t=f("div"),n=g("Chunk Size: "),r=g(i),o=g("MB")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){1&t&&i!==(i=e[0].chunk_size_mb+"")&&y(r,i)},d(e){e&&m(t)}}}function zn(e){let t,n,r,o=e[0].total_segments+"";return{c(){t=f("div"),n=g("Segments: "),r=g(o)},m(e,o){u(e,t,o),d(t,n),d(t,r)},p(e,t){1&t&&o!==(o=e[0].total_segments+"")&&y(r,o)},d(e){e&&m(t)}}}function An(e){let t,n,r,o,i,l,s,a,c,p,h,k,w=e[6]?"Hide Debug Chunks":"View Debug Chunks",S=e[7].length>0&&Fn(e),$=e[6]&&e[7].length>0&&On(e),j=e[8]&&Un();return{c(){t=f("div"),n=f("div"),r=g("🐛 Debug Chunks\n                    "),S&&S.c(),o=b(),$&&$.c(),i=b(),l=f("button"),s=f("iconify-icon"),a=b(),c=g(w),p=b(),j&&j.c(),_(n,"class","text-terminal-text font-bold mb-2 text-xs flex items-center gap-2"),v(s,"icon","mdi:folder-download"),v(s,"class","text-xs"),_(l,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-2 py-1 text-xs hover:bg-gray-700 transition-colors flex items-center gap-1 w-full"),_(t,"class","border-t border-terminal-border pt-2 mt-2")},m(m,f){u(m,t,f),d(t,n),d(n,r),S&&S.m(n,null),d(t,o),$&&$.m(t,null),d(t,i),d(t,l),d(l,s),d(l,a),d(l,c),d(l,p),j&&j.m(l,null),h||(k=x(l,"click",e[15]),h=!0)},p(e,r){e[7].length>0?S?S.p(e,r):(S=Fn(e),S.c(),S.m(n,null)):S&&(S.d(1),S=null),e[6]&&e[7].length>0?$?$.p(e,r):($=On(e),$.c(),$.m(t,i)):$&&($.d(1),$=null),64&r&&w!==(w=e[6]?"Hide Debug Chunks":"View Debug Chunks")&&y(c,w),e[8]?j||(j=Un(),j.c(),j.m(l,null)):j&&(j.d(1),j=null)},d(e){e&&m(t),S&&S.d(),$&&$.d(),j&&j.d(),h=!1,k()}}}function Fn(e){let t,n,r,o=e[7].length+"";return{c(){t=f("span"),n=g(o),r=g(" saved"),_(t,"class","bg-green-600 text-white px-1 py-0.5 rounded text-xs")},m(e,o){u(e,t,o),d(t,n),d(t,r)},p(e,t){128&t&&o!==(o=e[7].length+"")&&y(n,o)},d(e){e&&m(t)}}}function On(e){let t,n=X(e[7]),r=[];for(let t=0;t<n.length;t+=1)r[t]=Pn(vn(e,n,t));return{c(){t=f("div");for(let e=0;e<r.length;e+=1)r[e].c();_(t,"class","space-y-1 mb-2")},m(e,n){u(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,o){if(129&o){let i;for(n=X(e[7]),i=0;i<n.length;i+=1){const l=vn(e,n,i);r[i]?r[i].p(l,o):(r[i]=Pn(l),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){e&&m(t),p(r,e)}}}function Dn(e){let t;return{c(){t=f("span"),t.textContent="⚠ May not play",_(t,"class","text-yellow-400")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function In(e){let t;return{c(){t=f("span"),t.textContent="✓ Playable",_(t,"class","text-green-400")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Rn(e){let t,n,r,o,i=e[21].chunking_method+"";return{c(){t=f("span"),n=g("("),r=g(i),o=g(")"),_(t,"class","text-terminal-text-dim text-xs")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){128&t&&i!==(i=e[21].chunking_method+"")&&y(r,i)},d(e){e&&m(t)}}}function Pn(e){let t,n,r,o,i,l,s,a,c,p,h,x,k,w,S,$,j,C=e[21].chunk_index+"",T=Re(e[21].actual_size||e[21].audio_data_size)+"";function L(e,t){return e[21].is_playable?In:Dn}let E=L(e),M=E(e),z=e[21].chunking_method&&Rn(e);return{c(){t=f("div"),n=f("div"),r=f("span"),o=g("Chunk "),i=g(C),l=b(),M.c(),s=b(),a=f("span"),c=g(T),p=b(),h=f("div"),x=f("a"),k=f("iconify-icon"),w=g("\n                              Download"),$=b(),z&&z.c(),j=b(),_(r,"class","font-bold text-terminal-text"),_(a,"class","text-terminal-text-dim"),_(n,"class","flex items-center justify-between mb-1"),v(k,"icon","mdi:download"),v(k,"class","text-xs"),_(x,"href",S="/debug/chunk?"+("chunked_upload_streaming"===e[0].processing_method?"parent_job_id":"job_id")+"="+e[0].job_id+"&chunk_index="+e[21].chunk_index),_(x,"target","_blank"),_(x,"class","text-terminal-accent hover:text-yellow-400 transition-colors text-xs flex items-center gap-1"),_(h,"class","flex items-center gap-2"),_(t,"class","bg-terminal-bg-light border border-terminal-border p-2 text-xs")},m(e,m){u(e,t,m),d(t,n),d(n,r),d(r,o),d(r,i),d(r,l),M.m(r,null),d(n,s),d(n,a),d(a,c),d(t,p),d(t,h),d(h,x),d(x,k),d(x,w),d(h,$),z&&z.m(h,null),d(t,j)},p(e,t){128&t&&C!==(C=e[21].chunk_index+"")&&y(i,C),E!==(E=L(e))&&(M.d(1),M=E(e),M&&(M.c(),M.m(r,null))),128&t&&T!==(T=Re(e[21].actual_size||e[21].audio_data_size)+"")&&y(c,T),129&t&&S!==(S="/debug/chunk?"+("chunked_upload_streaming"===e[0].processing_method?"parent_job_id":"job_id")+"="+e[0].job_id+"&chunk_index="+e[21].chunk_index)&&_(x,"href",S),e[21].chunking_method?z?z.p(e,t):(z=Rn(e),z.c(),z.m(h,null)):z&&(z.d(1),z=null)},d(e){e&&m(t),M.d(),z&&z.d()}}}function Un(e){let t;return{c(){t=f("iconify-icon"),v(t,"icon","mdi:loading"),v(t,"class","text-xs animate-spin")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Nn(e){let t;return{c(){t=g("Final Transcript")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Bn(e){let t;return{c(){t=g("Final Transcript (Streaming)")},m(e,n){u(e,t,n)},d(e){e&&m(t)}}}function Jn(e){let t;function n(e,t){return e[2]?Kn:e[3]&&e[5]?Vn:e[3]?qn:"processing"===e[0].status||"uploaded"===e[0].status?Gn:Hn}let r=n(e),o=r(e);return{c(){o.c(),t=h()},m(e,n){o.m(e,n),u(e,t,n)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){e&&m(t),o.d(e)}}}function Wn(e){let t;function n(e,t){return e[0].final_transcript?er:e[0].corrected_transcript?Zn:e[0].raw_transcript?Yn:Qn}let r=n(e),o=r(e);return{c(){o.c(),t=h()},m(e,n){o.m(e,n),u(e,t,n)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){e&&m(t),o.d(e)}}}function Hn(t){let n;return{c(){n=f("div"),n.textContent="Transcript will load when expanded",_(n,"class","text-terminal-text-dim italic")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Gn(e){let t,n,r,o=e[0].progress&&Xn(e);return{c(){t=f("div"),n=f("iconify-icon"),r=g("\n                       Transcript will be available when processing completes...\n                       "),o&&o.c(),v(n,"icon","mdi:clock-processing"),v(n,"class","animate-pulse"),_(t,"class","text-terminal-text-dim italic flex items-center gap-2")},m(e,i){u(e,t,i),d(t,n),d(t,r),o&&o.m(t,null)},p(e,n){e[0].progress?o?o.p(e,n):(o=Xn(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(e){e&&m(t),o&&o.d()}}}function qn(t){let n;return{c(){n=f("div"),n.textContent="No transcript available",_(n,"class","text-terminal-text-dim italic")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Vn(e){let t,n;return{c(){t=f("pre"),n=g(e[5]),_(t,"class","whitespace-pre-wrap text-terminal-text")},m(e,r){u(e,t,r),d(t,n)},p(e,t){32&t&&y(n,e[5])},d(e){e&&m(t)}}}function Kn(t){let n;return{c(){n=f("div"),n.innerHTML='<iconify-icon icon="mdi:loading" class="animate-spin"></iconify-icon>\n                       Loading transcript...',_(n,"class","text-terminal-text-dim italic flex items-center gap-2")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Xn(e){let t,n,r,o,i=e[0].progress+"";return{c(){t=f("span"),n=g("("),r=g(i),o=g("% complete)"),_(t,"class","text-terminal-accent")},m(e,i){u(e,t,i),d(t,n),d(t,r),d(t,o)},p(e,t){1&t&&i!==(i=e[0].progress+"")&&y(r,i)},d(e){e&&m(t)}}}function Qn(t){let n;return{c(){n=f("div"),n.textContent="No transcript available",_(n,"class","text-terminal-text-dim italic")},m(e,t){u(e,n,t)},p:e,d(e){e&&m(n)}}}function Yn(e){let t,n,r=e[0].raw_transcript+"";return{c(){t=f("pre"),n=g(r),_(t,"class","whitespace-pre-wrap text-terminal-text")},m(e,r){u(e,t,r),d(t,n)},p(e,t){1&t&&r!==(r=e[0].raw_transcript+"")&&y(n,r)},d(e){e&&m(t)}}}function Zn(e){let t,n,r=e[0].corrected_transcript+"";return{c(){t=f("pre"),n=g(r),_(t,"class","whitespace-pre-wrap text-terminal-text")},m(e,r){u(e,t,r),d(t,n)},p(e,t){1&t&&r!==(r=e[0].corrected_transcript+"")&&y(n,r)},d(e){e&&m(t)}}}function er(e){let t,n,r=e[0].final_transcript+"";return{c(){t=f("pre"),n=g(r),_(t,"class","whitespace-pre-wrap text-terminal-text")},m(e,r){u(e,t,r),d(t,n)},p(e,t){1&t&&r!==(r=e[0].final_transcript+"")&&y(n,r)},d(e){e&&m(t)}}}function tr(t){let n,o,i,l,s,a,c,p,h,k,w,S,$,C,T,L,E,M,z,A,F,O,D,I,R,P,U,N,B,J,W,H,G,q,V,K,X,Q,Y,Z,ee,te,ne,re,oe,ie,le,se,ae,ce,de,ue=(t[0].filename||"Unknown")+"",me=t[0].job_id.slice(0,8)+"",pe=Re(t[0].file_size||0)+"",fe=(t[0].processing_method||"direct")+"",ge=nr(t[0])+"",be=new Date(t[0].created_at).toLocaleString()+"",he="url"===t[0].upload_method&&yn(),xe="streaming"===t[0].upload_method&&kn(),_e=t[0].total_segments>0&&wn(t),ve=void 0!==t[0].progress&&("processing"===t[0].status||"uploaded"===t[0].status)&&Sn(t),ye=t[0].use_llm&&$n(),ke=t[0].error&&jn(t),we=t[1]&&Cn(t);return{c(){n=f("div"),o=f("div"),i=f("div"),l=f("div"),s=f("div"),a=f("iconify-icon"),c=b(),p=f("span"),h=g(ue),k=b(),he&&he.c(),w=b(),xe&&xe.c(),S=b(),$=f("div"),C=f("span"),T=f("iconify-icon"),L=b(),E=g(me),M=g("..."),z=b(),A=f("span"),F=f("iconify-icon"),O=b(),D=g(pe),I=b(),R=f("span"),P=f("iconify-icon"),U=b(),N=g(fe),B=b(),_e&&_e.c(),J=b(),W=f("div"),H=f("div"),G=f("iconify-icon"),V=b(),K=g(ge),Q=b(),Y=f("button"),Y.innerHTML='<iconify-icon icon="mdi:delete" class="text-lg"></iconify-icon>',Z=b(),ve&&ve.c(),ee=b(),te=f("div"),ne=f("span"),re=f("iconify-icon"),oe=b(),ie=g(be),le=b(),ye&&ye.c(),se=b(),ke&&ke.c(),ae=b(),we&&we.c(),v(a,"icon","mdi:file-music"),v(a,"class","text-terminal-accent"),_(p,"class","font-bold"),_(s,"class","flex items-center gap-2 mb-1"),v(T,"icon","mdi:identifier"),v(T,"class","text-xs"),v(F,"icon","mdi:file-outline"),v(F,"class","text-xs"),v(P,"icon","mdi:cog"),v(P,"class","text-xs"),_($,"class","flex flex-wrap gap-3 text-xs text-terminal-text-dim"),_(l,"class","flex-1 min-w-0"),v(G,"icon",q=t[10](t[0].status)),v(G,"class","text-xs"),j(G,"animate-spin","processing"===t[0].status||"uploaded"===t[0].status),_(H,"class",X="px-2 py-1 text-xs font-bold uppercase "+t[9](t[0].status)+" flex items-center gap-1"),_(Y,"class","text-status-error hover:bg-status-error hover:text-terminal-bg transition-colors p-1 rounded flex items-center justify-center"),_(Y,"title","Delete job"),_(W,"class","flex items-center gap-2 flex-shrink-0"),_(i,"class","flex items-start gap-3"),v(re,"icon","mdi:clock-outline"),v(re,"class","text-xs"),_(te,"class","mt-2 flex flex-wrap gap-3 text-xs text-terminal-text-dim"),_(o,"class","p-3 pr-4 hover:bg-gray-800/5 transition-colors cursor-pointer"),_(o,"role","button"),_(o,"tabindex","0"),_(n,"class","border-b border-terminal-border")},m(e,r){var m;u(e,n,r),d(n,o),d(o,i),d(i,l),d(l,s),d(s,a),d(s,c),d(s,p),d(p,h),d(s,k),he&&he.m(s,null),d(s,w),xe&&xe.m(s,null),d(l,S),d(l,$),d($,C),d(C,T),d(C,L),d(C,E),d(C,M),d($,z),d($,A),d(A,F),d(A,O),d(A,D),d($,I),d($,R),d(R,P),d(R,U),d(R,N),d($,B),_e&&_e.m($,null),d(i,J),d(i,W),d(W,H),d(H,G),d(H,V),d(H,K),d(W,Q),d(W,Y),d(o,Z),ve&&ve.m(o,null),d(o,ee),d(o,te),d(te,ne),d(ne,re),d(ne,oe),d(ne,ie),d(te,le),ye&&ye.m(te,null),d(te,se),ke&&ke.m(te,null),d(n,ae),we&&we.m(n,null),ce||(de=[x(Y,"click",(m=t[11],function(e){return e.stopPropagation(),m.call(this,e)})),x(o,"click",t[14]),x(o,"keydown",t[16])],ce=!0)},p(e,[t]){1&t&&ue!==(ue=(e[0].filename||"Unknown")+"")&&y(h,ue),"url"===e[0].upload_method?he||(he=yn(),he.c(),he.m(s,w)):he&&(he.d(1),he=null),"streaming"===e[0].upload_method?xe||(xe=kn(),xe.c(),xe.m(s,null)):xe&&(xe.d(1),xe=null),1&t&&me!==(me=e[0].job_id.slice(0,8)+"")&&y(E,me),1&t&&pe!==(pe=Re(e[0].file_size||0)+"")&&y(D,pe),1&t&&fe!==(fe=(e[0].processing_method||"direct")+"")&&y(N,fe),e[0].total_segments>0?_e?_e.p(e,t):(_e=wn(e),_e.c(),_e.m($,null)):_e&&(_e.d(1),_e=null),1&t&&q!==(q=e[10](e[0].status))&&v(G,"icon",q),1&t&&j(G,"animate-spin","processing"===e[0].status||"uploaded"===e[0].status),1&t&&ge!==(ge=nr(e[0])+"")&&y(K,ge),1&t&&X!==(X="px-2 py-1 text-xs font-bold uppercase "+e[9](e[0].status)+" flex items-center gap-1")&&_(H,"class",X),void 0===e[0].progress||"processing"!==e[0].status&&"uploaded"!==e[0].status?ve&&(ve.d(1),ve=null):ve?ve.p(e,t):(ve=Sn(e),ve.c(),ve.m(o,ee)),1&t&&be!==(be=new Date(e[0].created_at).toLocaleString()+"")&&y(ie,be),e[0].use_llm?ye||(ye=$n(),ye.c(),ye.m(te,se)):ye&&(ye.d(1),ye=null),e[0].error?ke?ke.p(e,t):(ke=jn(e),ke.c(),ke.m(te,null)):ke&&(ke.d(1),ke=null),e[1]?we?we.p(e,t):(we=Cn(e),we.c(),we.m(n,null)):we&&(we.d(1),we=null)},i:e,o:e,d(e){e&&m(n),he&&he.d(),xe&&xe.d(),_e&&_e.d(),ve&&ve.d(),ye&&ye.d(),ke&&ke.d(),we&&we.d(),ce=!1,r(de)}}}function nr(e){return e.status?"processing"===e.status||"uploaded"===e.status?"streaming"===e.processing_method?"STREAMING":"PROCESSING":"done"===e.status?"COMPLETED":e.status.toUpperCase():"UNKNOWN"}function rr(e,t,n){let{job:r}=t,o=!1,i=!1,l="",a=!1,c=!1,d=!1,u=[],m=!1;const p={processing:"bg-status-info text-terminal-bg",uploaded:"bg-status-info text-terminal-bg",failed:"bg-status-error text-terminal-bg",done:"bg-status-success text-terminal-bg",unknown:"bg-status-warning text-terminal-bg"},f={processing:"mdi:sync",uploaded:"mdi:sync",failed:"mdi:alert-circle",done:"mdi:check-circle",unknown:"mdi:help-circle"};async function g(){if(!a&&!c&&"streaming"!==r.processing_method){n(2,a=!0);try{const e=await fetch(`/result?job_id=${r.job_id}`);if(e.ok){const t=await e.json();n(5,l=t.final||"No transcript available"),n(3,c=!0)}else n(5,l="Failed to fetch transcript")}catch(e){n(5,l="Error loading transcript: "+e.message)}finally{n(2,a=!1)}}}function b(){n(1,o=!o),o&&"done"===r.status&&"streaming"!==r.processing_method&&g()}return e.$$set=e=>{"job"in e&&n(0,r=e.job)},e.$$.update=()=>{15&e.$$.dirty&&(!o||"done"!==r.status||"streaming"===r.processing_method||c||a||g())},[r,o,a,c,i,l,d,u,m,function(e){return p[e?.toLowerCase()]||"bg-status-warning text-terminal-bg"},function(e){return f[e?.toLowerCase()]||"mdi:clock"},async function(){if(confirm("Are you sure you want to delete this job?"))try{await async function(e){const t=s(ue),n=t.find(t=>t.job_id===e);if(!n)throw new Error("Job not found");const r=t.length;if("streaming"===n.processing_method){console.log("Deleting streaming job locally and from server");const n=t.filter(t=>t.job_id!==e);return ue.set(n),fetch("/delete-job",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e})}).then(t=>{t.ok?ce.info("delete","Also deleted streaming job from server KV",{job_id:e}):ce.debug("Streaming job not found on server (local only)",{job_id:e})}).catch(t=>{ce.debug("Error deleting streaming job from server (likely local only)",{job_id:e,error:t.message})}),console.log("Jobs after streaming deletion:",n.length,"removed:",r-n.length),void ce.info("delete","Deleted streaming job locally",{job_id:e,count_before:r,count_after:n.length})}const o=await fetch("/delete-job",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e})});if(!o.ok){const e=await o.json();throw console.error("Server deletion failed:",e),new Error(e.error||"Delete failed")}{console.log("Server deletion successful, removing from local array");const n=t.filter(t=>t.job_id!==e);ue.set(n),console.log("Jobs after server deletion:",n.length,"removed:",r-n.length),ce.info("delete","Deleted server job",{job_id:e,count_before:r,count_after:n.length})}}(r.job_id)}catch(e){alert("Failed to delete job: "+e.message)}},async function(){if(!i){n(4,i=!0);try{await async function(e){const t=s(ue).find(t=>t.job_id===e);if(!t)throw new Error("Job not found");let n="";if("streaming"===t.processing_method)n=t.final_transcript||t.corrected_transcript||t.raw_transcript||"No transcript available";else{const t=await fetch("/result?job_id="+e);n=t.ok?(await t.json()).final||"No transcript available":"Failed to fetch transcript"}return await navigator.clipboard.writeText(n),n}(r.job_id),setTimeout(()=>n(4,i=!1),2e3)}catch(e){alert("Failed to copy transcript: "+e.message),n(4,i=!1)}}},async function(){try{await async function(e){const t=s(ue).find(t=>t.job_id===e);if(!t)throw new Error("Job not found");let n={...t};if("streaming"!==t.processing_method)try{const t=await fetch("/result?job_id="+e);if(t.ok){const e=await t.json();n.transcript_data=e}}catch(e){ce.warn("Could not fetch full transcript data for JSON export",e)}const r=JSON.stringify(n,null,2);return await navigator.clipboard.writeText(r),r}(r.job_id)}catch(e){alert("Failed to copy job JSON: "+e.message)}},b,async function(){if(m||d)n(6,d=!d);else{n(8,m=!0);try{const e="chunked_upload_streaming"===r.processing_method?"parent_job_id":"job_id",t=await fetch(`/debug/chunks?${e}=${r.job_id}`);if(t.ok){const e=await t.json();n(7,u=e.debug_chunks||[]),n(6,d=!0)}else alert("Failed to load debug chunks")}catch(e){console.error("Failed to load debug chunks:",e),alert("Error loading debug chunks: "+e.message)}finally{n(8,m=!1)}}},e=>"Enter"===e.key&&b()]}class or extends re{constructor(e){super(),ne(this,e,rr,tr,i,{job:0})}}function ir(e,t,n){const r=e.slice();return r[10]=t[n],r}function lr(e){let t,n,r,o=e[1].filter(ur).length+"";return{c(){t=f("span"),n=g(o),r=g(" Running"),_(t,"class","text-xs bg-status-info text-terminal-bg px-2 py-1 rounded")},m(e,o){u(e,t,o),d(t,n),d(t,r)},p(e,t){2&t&&o!==(o=e[1].filter(ur).length+"")&&y(n,o)},d(e){e&&m(t)}}}function sr(e){let t,n,o=[],i=new Map,l=X(e[1]);const s=e=>e[10].job_id;for(let t=0;t<l.length;t+=1){let n=ir(e,l,t),r=s(n);i.set(r,o[t]=cr(r,n))}return{c(){t=f("div");for(let e=0;e<o.length;e+=1)o[e].c();_(t,"class","border border-x-2 border-terminal-border")},m(e,r){u(e,t,r);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);n=!0},p(e,n){2&n&&(l=X(e[1]),G(),o=function(e,t,n,o,i,l,s,a,c,d,u,m){let p=e.length,f=l.length,g=p;const b={};for(;g--;)b[e[g].key]=g;const h=[],x=new Map,_=new Map,v=[];for(g=f;g--;){const e=m(i,l,g),r=n(e);let o=s.get(r);o?v.push(()=>o.p(e,t)):(o=d(r,e),o.c()),x.set(r,h[g]=o),r in b&&_.set(r,Math.abs(g-b[r]))}const y=new Set,k=new Set;function w(e){V(e,1),e.m(a,u),s.set(e.key,e),u=e.first,f--}for(;p&&f;){const t=h[f-1],n=e[p-1],r=t.key,o=n.key;t===n?(u=t.first,p--,f--):x.has(o)?!s.has(r)||y.has(r)?w(t):k.has(o)?p--:_.get(r)>_.get(o)?(k.add(r),w(t)):(y.add(o),p--):(c(n,s),p--)}for(;p--;){const t=e[p];x.has(t.key)||c(t,s)}for(;f;)w(h[f-1]);return r(v),h}(o,n,s,0,e,l,i,t,Q,cr,null,ir),q())},i(e){if(!n){for(let e=0;e<l.length;e+=1)V(o[e]);n=!0}},o(e){for(let e=0;e<o.length;e+=1)K(o[e]);n=!1},d(e){e&&m(t);for(let e=0;e<o.length;e+=1)o[e].d()}}}function ar(t){let n;return{c(){n=f("div"),n.textContent="No jobs yet",_(n,"class","py-10 px-5 text-center text-terminal-text-dim")},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&m(n)}}}function cr(e,t){let n,r,o;return r=new or({props:{job:t[10]}}),{key:e,first:null,c(){n=h(),Y(r.$$.fragment),this.first=n},m(e,t){u(e,n,t),Z(r,e,t),o=!0},p(e,n){t=e;const o={};2&n&&(o.job=t[10]),r.$set(o)},i(e){o||(V(r.$$.fragment,e),o=!0)},o(e){K(r.$$.fragment,e),o=!1},d(e){e&&m(n),ee(r,e)}}}function dr(e){let t,n,o,i,l,s,a,c,p,h,k,w,S,$,C,T,L,E,M,z,A,F,O,D,I,R,P=e[1].length+"",U=e[2]?"Refreshing...":"Refresh",N=e[0]&&lr(e);const B=[ar,sr],J=[];function W(e,t){return 0===e[1].length?0:1}return F=W(e),O=J[F]=B[F](e),{c(){t=f("div"),n=f("div"),o=f("div"),i=f("span"),l=g("Jobs ("),s=g(P),a=g(")"),c=b(),N&&N.c(),p=b(),h=f("div"),k=f("button"),w=f("iconify-icon"),S=g("\n        Delete All"),C=b(),T=f("button"),L=f("iconify-icon"),M=b(),z=g(U),A=b(),O.c(),_(i,"class","font-bold"),_(o,"class","flex items-center gap-2"),v(w,"icon","mdi:delete-sweep"),v(w,"class","text-sm"),k.disabled=$=0===e[1].length,_(k,"class","bg-terminal-bg-light border border-terminal-border text-status-error px-3 py-1 text-xs hover:bg-red-900/30 transition-colors flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed"),v(L,"icon",E=e[2]?"mdi:loading":"mdi:refresh"),v(L,"class","text-sm"),j(L,"animate-spin",e[2]),T.disabled=e[2],_(T,"class","bg-terminal-bg-light border border-terminal-border text-terminal-text px-3 py-1 text-xs hover:bg-gray-700 transition-colors flex items-center gap-1"),_(h,"class","flex items-center gap-2"),_(n,"class","flex items-center justify-between py-2 border-b border-terminal-border")},m(r,m){u(r,t,m),d(t,n),d(n,o),d(o,i),d(i,l),d(i,s),d(i,a),d(o,c),N&&N.m(o,null),d(n,p),d(n,h),d(h,k),d(k,w),d(k,S),d(h,C),d(h,T),d(T,L),d(T,M),d(T,z),d(t,A),J[F].m(t,null),D=!0,I||(R=[x(k,"click",e[4]),x(T,"click",e[3])],I=!0)},p(e,[n]){(!D||2&n)&&P!==(P=e[1].length+"")&&y(s,P),e[0]?N?N.p(e,n):(N=lr(e),N.c(),N.m(o,null)):N&&(N.d(1),N=null),(!D||2&n&&$!==($=0===e[1].length))&&(k.disabled=$),(!D||4&n&&E!==(E=e[2]?"mdi:loading":"mdi:refresh"))&&v(L,"icon",E),(!D||4&n)&&j(L,"animate-spin",e[2]),(!D||4&n)&&U!==(U=e[2]?"Refreshing...":"Refresh")&&y(z,U),(!D||4&n)&&(T.disabled=e[2]);let r=F;F=W(e),F===r?J[F].p(e,n):(G(),K(J[r],1,1,()=>{J[r]=null}),q(),O=J[F],O?O.p(e,n):(O=J[F]=B[F](e),O.c()),V(O,1),O.m(t,null))},i(e){D||(V(O),D=!0)},o(e){K(O),D=!1},d(e){e&&m(t),N&&N.d(),J[F].d(),I=!1,r(R)}}}const ur=e=>"processing"===e.status||"uploaded"===e.status||"awaiting_upload"===e.status;function mr(e,t,n){let r,o,i;a(e,ue,e=>n(1,i=e));let l=!1,c=null;function d(){c||n(5,c=setInterval(async()=>{if(r)try{await Be()}catch(e){console.error("Auto-refresh failed:",e)}},3e3))}function u(){c&&(clearInterval(c),n(5,c=null))}E(()=>{d()}),M(()=>{u()});let m=null;return M(()=>{u(),m&&(clearInterval(m),n(6,m=null))}),e.$$.update=()=>{2&e.$$.dirty&&n(0,r=i.some(e=>"processing"===e.status||"uploaded"===e.status||"awaiting_upload"===e.status)),33&e.$$.dirty&&(r?d():!r&&c&&setTimeout(()=>{r||u()},1e4)),2&e.$$.dirty&&n(7,o=i.some(e=>"processing"===e.status&&e.progress&&e.progress>80)),192&e.$$.dirty&&(o&&!m?(console.log("Starting fast refresh for completing jobs"),n(6,m=setInterval(async()=>{if(o)try{await Be()}catch(e){console.error("Fast refresh failed:",e)}},1e3))):!o&&m&&(console.log("Stopping fast refresh"),clearInterval(m),n(6,m=null)))},[r,i,l,async function(){n(2,l=!0);try{await Be(),setTimeout(()=>n(2,l=!1),1500)}catch(e){console.error("Refresh failed:",e),n(2,l=!1)}},async function(){if(confirm("Are you sure you want to delete all jobs? This action cannot be undone."))try{await async function(){const e=s(ue);if(0===e.length)return;ce.info("delete","Starting delete all jobs operation",{total_jobs:e.length});const t=e.filter(e=>"streaming"===e.processing_method),n=e.filter(e=>"streaming"!==e.processing_method);if(ue.set([]),t.length>0&&(ce.info("delete","Deleting streaming jobs from server (background)",{count:t.length}),t.forEach(e=>{fetch("/delete-job",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e.job_id})}).catch(t=>{ce.debug("Background streaming job deletion failed (expected for local-only jobs)",{job_id:e.job_id,error:t.message})})})),n.length>0){ce.info("delete","Deleting server jobs",{count:n.length});const e=n.map(e=>fetch("/delete-job",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e.job_id})}).catch(t=>(ce.error("Failed to delete server job",t,{job_id:e.job_id}),null)));await Promise.allSettled(e)}ce.complete("Delete all jobs completed",{streaming_jobs:t.length,server_jobs:n.length,total:e.length})}(),console.log("All jobs deleted from API.")}catch(e){console.error("Failed to delete all jobs:",e)}},c,m,o]}class pr extends re{constructor(e){super(),ne(this,e,mr,dr,i,{})}}function fr(t){let n;return{c(){n=f("div"),n.innerHTML='<div class="text-md text-terminal-text-dim mb-2">Groq Whisper XL - Universal Audio Transcription Tool</div> <div class="flex justify-center"><a href="https://groq.com" target="_blank" rel="noopener noreferrer"><img class="w-40 mt-8" src="https://console.groq.com/powered-by-groq.svg" alt="Powered by Groq for fast inference."/></a></div>',_(n,"class","mt-4 p-3 text-center")},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&m(n)}}}class gr extends re{constructor(e){super(),ne(this,e,null,fr,i,{})}}function br(t){let n,r,o,i,l,s,a,c,p,g;return r=new ie({}),i=new _n({}),s=new pr({}),p=new gr({}),{c(){n=f("main"),Y(r.$$.fragment),o=b(),Y(i.$$.fragment),l=b(),Y(s.$$.fragment),a=b(),c=f("div"),Y(p.$$.fragment),_(n,"class","max-w-6xl mx-auto p-5 bg-terminal-bg-light"),_(c,"class","mb-8")},m(e,t){u(e,n,t),Z(r,n,null),d(n,o),Z(i,n,null),d(n,l),Z(s,n,null),u(e,a,t),u(e,c,t),Z(p,c,null),g=!0},p:e,i(e){g||(V(r.$$.fragment,e),V(i.$$.fragment,e),V(s.$$.fragment,e),V(p.$$.fragment,e),g=!0)},o(e){K(r.$$.fragment,e),K(i.$$.fragment,e),K(s.$$.fragment,e),K(p.$$.fragment,e),g=!1},d(e){e&&(m(n),m(a),m(c)),ee(r),ee(i),ee(s),ee(p)}}}function hr(e){return E(()=>{Be()}),[]}return new class extends re{constructor(e){super(),ne(this,e,hr,br,i,{})}}({target:document.getElementById("app")})}();
